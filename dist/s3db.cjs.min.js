/* istanbul ignore file */
"use strict";var ir=require("nanoid"),P=require("lodash-es"),Ae=require("@supercharge/promise-pool"),Te=require("@aws-sdk/client-s3"),ae=require("flat"),za=require("fastest-validator"),Ba=require("avsc"),nr=require("node:stream");function ni(e,t){for(var r=0,i=e.length-1;i>=0;i--){var n=e[i];n==="."?e.splice(i,1):n===".."?(e.splice(i,1),r++):r&&(e.splice(i,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}var Ua=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,ar=function(e){return Ua.exec(e).slice(1)};function or(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var i=r>=0?arguments[r]:"/";if(typeof i!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!i)continue;e=i+"/"+e,t=i.charAt(0)==="/"}return e=ni(sr(e.split("/"),function(n){return!!n}),!t).join("/"),(t?"/":"")+e||"."}function ai(e){var t=oi(e),r=Ya(e,-1)==="/";return e=ni(sr(e.split("/"),function(i){return!!i}),!t).join("/"),!e&&!t&&(e="."),e&&r&&(e+="/"),(t?"/":"")+e}function oi(e){return e.charAt(0)==="/"}function Pa(){var e=Array.prototype.slice.call(arguments,0);return ai(sr(e,function(t,r){if(typeof t!="string")throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))}function Za(e,t){e=or(e).substr(1),t=or(t).substr(1);function r(f){for(var l=0;l<f.length&&f[l]==="";l++);for(var _=f.length-1;_>=0&&f[_]==="";_--);return l>_?[]:f.slice(l,_-l+1)}for(var i=r(e.split("/")),n=r(t.split("/")),a=Math.min(i.length,n.length),o=a,s=0;s<a;s++)if(i[s]!==n[s]){o=s;break}for(var h=[],s=o;s<i.length;s++)h.push("..");return h=h.concat(n.slice(o)),h.join("/")}var ja="/",$a=":";function Ha(e){var t=ar(e),r=t[0],i=t[1];return!r&&!i?".":(i&&(i=i.substr(0,i.length-1)),r+i)}function Wa(e,t){var r=ar(e)[2];return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r}function Ka(e){return ar(e)[3]}var Y={extname:Ka,basename:Wa,dirname:Ha,sep:ja,delimiter:$a,relative:Za,join:Pa,isAbsolute:oi,normalize:ai,resolve:or};function sr(e,t){if(e.filter)return e.filter(t);for(var r=[],i=0;i<e.length;i++)t(e[i],i,e)&&r.push(e[i]);return r}var Ya="ab".substr(-1)==="b"?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)},qa;function de(){}de.prototype=Object.create(null);function C(){C.init.call(this)}C.EventEmitter=C,C.usingDomains=!1,C.prototype.domain=void 0,C.prototype._events=void 0,C.prototype._maxListeners=void 0,C.defaultMaxListeners=10,C.init=function(){this.domain=null,C.usingDomains&&qa.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new de,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},C.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this};function si(e){return e._maxListeners===void 0?C.defaultMaxListeners:e._maxListeners}C.prototype.getMaxListeners=function(){return si(this)};function Ga(e,t,r){if(t)e.call(r);else for(var i=e.length,n=st(e,i),a=0;a<i;++a)n[a].call(r)}function Va(e,t,r,i){if(t)e.call(r,i);else for(var n=e.length,a=st(e,n),o=0;o<n;++o)a[o].call(r,i)}function Xa(e,t,r,i,n){if(t)e.call(r,i,n);else for(var a=e.length,o=st(e,a),s=0;s<a;++s)o[s].call(r,i,n)}function Ja(e,t,r,i,n,a){if(t)e.call(r,i,n,a);else for(var o=e.length,s=st(e,o),h=0;h<o;++h)s[h].call(r,i,n,a)}function Qa(e,t,r,i){if(t)e.apply(r,i);else for(var n=e.length,a=st(e,n),o=0;o<n;++o)a[o].apply(r,i)}C.prototype.emit=function(t){var r,i,n,a,o,s,h,f=t==="error";if(s=this._events,s)f=f&&s.error==null;else if(!f)return!1;if(h=this.domain,f){if(r=arguments[1],h)r||(r=new Error('Uncaught, unspecified "error" event')),r.domainEmitter=this,r.domain=h,r.domainThrown=!1,h.emit("error",r);else{if(r instanceof Error)throw r;var l=new Error('Uncaught, unspecified "error" event. ('+r+")");throw l.context=r,l}return!1}if(i=s[t],!i)return!1;var _=typeof i=="function";switch(n=arguments.length,n){case 1:Ga(i,_,this);break;case 2:Va(i,_,this,arguments[1]);break;case 3:Xa(i,_,this,arguments[1],arguments[2]);break;case 4:Ja(i,_,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=new Array(n-1),o=1;o<n;o++)a[o-1]=arguments[o];Qa(i,_,this,a)}return!0};function fi(e,t,r,i){var n,a,o;if(typeof r!="function")throw new TypeError('"listener" argument must be a function');if(a=e._events,a?(a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),o=a[t]):(a=e._events=new de,e._eventsCount=0),!o)o=a[t]=r,++e._eventsCount;else if(typeof o=="function"?o=a[t]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),!o.warned&&(n=si(e),n&&n>0&&o.length>n)){o.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=o.length,eo(s)}return e}function eo(e){typeof console.warn=="function"?console.warn(e):console.log(e)}C.prototype.addListener=function(t,r){return fi(this,t,r,!1)},C.prototype.on=C.prototype.addListener,C.prototype.prependListener=function(t,r){return fi(this,t,r,!0)};function li(e,t,r){var i=!1;function n(){e.removeListener(t,n),i||(i=!0,r.apply(e,arguments))}return n.listener=r,n}C.prototype.once=function(t,r){if(typeof r!="function")throw new TypeError('"listener" argument must be a function');return this.on(t,li(this,t,r)),this},C.prototype.prependOnceListener=function(t,r){if(typeof r!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(t,li(this,t,r)),this},C.prototype.removeListener=function(t,r){var i,n,a,o,s;if(typeof r!="function")throw new TypeError('"listener" argument must be a function');if(n=this._events,!n)return this;if(i=n[t],!i)return this;if(i===r||i.listener&&i.listener===r)--this._eventsCount===0?this._events=new de:(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||r));else if(typeof i!="function"){for(a=-1,o=i.length;o-- >0;)if(i[o]===r||i[o].listener&&i[o].listener===r){s=i[o].listener,a=o;break}if(a<0)return this;if(i.length===1){if(i[0]=void 0,--this._eventsCount===0)return this._events=new de,this;delete n[t]}else to(i,a);n.removeListener&&this.emit("removeListener",t,s||r)}return this},C.prototype.off=function(e,t){return this.removeListener(e,t)},C.prototype.removeAllListeners=function(t){var r,i;if(i=this._events,!i)return this;if(!i.removeListener)return arguments.length===0?(this._events=new de,this._eventsCount=0):i[t]&&(--this._eventsCount===0?this._events=new de:delete i[t]),this;if(arguments.length===0){for(var n=Object.keys(i),a=0,o;a<n.length;++a)o=n[a],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=new de,this._eventsCount=0,this}if(r=i[t],typeof r=="function")this.removeListener(t,r);else if(r)do this.removeListener(t,r[r.length-1]);while(r[0]);return this},C.prototype.listeners=function(t){var r,i,n=this._events;return n?(r=n[t],r?typeof r=="function"?i=[r.listener||r]:i=ro(r):i=[]):i=[],i},C.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):hi.call(e,t)},C.prototype.listenerCount=hi;function hi(e){var t=this._events;if(t){var r=t[e];if(typeof r=="function")return 1;if(r)return r.length}return 0}C.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function to(e,t){for(var r=t,i=r+1,n=e.length;i<n;r+=1,i+=1)e[r]=e[i];e.pop()}function st(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}function ro(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}class Ge extends Error{constructor({verbose:t,bucket:r,message:i,...n}){t&&(i=i+`

Verbose:

${JSON.stringify(n,null,2)}`),super(i),typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(i).stack,super.name=this.constructor.name,this.name=this.constructor.name,this.bucket=r,this.thrownAt=new Date}toJson(){return{...this}}toString(){return`${this.name} | ${this.message}`}}class ui extends Ge{constructor({bucket:t,...r}){super({...r,bucket:t,message:`Bucket does not exists [bucket:${t}]`})}}class fr extends Ge{constructor({bucket:t,key:r,...i}){super({...i,bucket:t,message:`Key does not exists [bucket:${t}/${r}]`}),this.key=r}}class ci extends fr{}class di extends Ge{constructor({bucket:t,...r}){super({...r,bucket:t,message:`Missing metadata for bucket [bucket:${t}]`})}}class lr extends Ge{constructor({bucket:t,resourceName:r,attributes:i,validation:n}){super({bucket:t,message:`This item is not valid. Resource=${r} [bucket:${t}].
${JSON.stringify(n,null,2)}`}),this.resourceName=r,this.attributes=i,this.validation=n}}class pi extends Ge{}const _i={NotFound:ci,NoSuchKey:fr,UnknownError:pi,NoSuchBucket:ui,MissingMetadata:di,InvalidResourceItem:lr},gi="us-east-1",wi="https://s3.us-east-1.amazonaws.com";class vi{constructor(t){let r;try{r=new URL(t)}catch{throw new Error("Invalid connection string: "+t)}this.region=gi,r.protocol==="s3:"?this.defineS3(r):this.defineMinio(r);for(const[i,n]of r.searchParams.entries())this[i]=n}defineS3(t){if(this.bucket=t.hostname,this.accessKeyId=t.username,this.secretAccessKey=t.password,this.endpoint=wi,["/","",null].includes(t.pathname))this.keyPrefix="";else{let[,...r]=t.pathname.split("/");this.keyPrefix=[...r||[]].join("/")}}defineMinio(t){if(this.forcePathStyle=!0,this.endpoint=t.origin,this.accessKeyId=t.username,this.secretAccessKey=t.password,["/","",null].includes(t.pathname))this.bucket="s3db",this.keyPrefix="";else{let[,r,...i]=t.pathname.split("/");this.bucket=r,this.keyPrefix=[...i||[]].join("/")}}}class mi extends C{constructor({verbose:t=!1,id:r=null,AwsS3Client:i,connectionString:n,parallelism:a=10}){super(),this.verbose=t,this.id=r??ir.nanoid(7),this.parallelism=a,this.config=new vi(n),this.client=i||this.createS3Client()}createS3Client(){let t={region:this.config.region,endpoint:this.config.endpoint};return this.config.forcePathStyle&&(t.forcePathStyle=!0),this.config.accessKeyId&&(t.credentials={accessKeyId:this.config.accessKeyId,secretAccessKey:this.config.secretAccessKey}),new Te.S3Client(t)}async sendCommand(t){this.emit("command.request",t.constructor.name,t.input);const r=console.warn;try{console.warn=n=>{n.includes("Stream of unknown length")||r(n)}}catch(n){console.error(n)}const i=await this.client.send(t);this.emit("command.response",t.constructor.name,i,t.input);try{console.warn=r}catch(n){console.error(n)}return i}errorProxy(t,r){this.verbose&&(r.bucket=this.config.bucket,r.config=this.config,r.verbose=this.verbose),t.data=r;const i=_i[t.name];return i?new i(r):t}async putObject({key:t,metadata:r,contentType:i,body:n,contentEncoding:a}){const o={Bucket:this.config.bucket,Key:this.config.keyPrefix?Y.join(this.config.keyPrefix,t):t,Metadata:{...r},Body:n||"",ContentType:i,ContentEncoding:a};try{const s=await this.sendCommand(new Te.PutObjectCommand(o));return this.emit("putObject",s,o),s}catch(s){throw this.errorProxy(s,{key:t,command:o})}}async getObject(t){const r={Bucket:this.config.bucket,Key:Y.join(this.config.keyPrefix,t)};try{const i=await this.sendCommand(new Te.GetObjectCommand(r));return this.emit("getObject",i,r),i}catch(i){throw this.errorProxy(i,{key:t,command:r})}}async headObject(t){const r={Bucket:this.config.bucket,Key:this.config.keyPrefix?Y.join(this.config.keyPrefix,t):t};try{const i=await this.client.send(new Te.HeadObjectCommand(r));return this.emit("headObject",i,r),i}catch(i){throw this.errorProxy(i,{key:t,command:r})}}async exists(t){try{return await this.headObject(t),!0}catch(r){if(r.name==="NoSuchKey")return!1;if(r.name==="NotFound")return!1;throw r}}async deleteObject(t){const r={Bucket:this.config.bucket,Key:this.config.keyPrefix?Y.join(this.config.keyPrefix,t):t};try{const i=await this.sendCommand(new Te.DeleteObjectCommand(r));return this.emit("deleteObject",i,r),i}catch(i){throw this.errorProxy(i,{key:t,command:r})}}async deleteObjects(t){const r=P.chunk(t,1e3),{results:i,errors:n}=await Ae.PromisePool.for(r).withConcurrency(this.parallelism).process(async o=>{const s={Bucket:this.config.bucket,Delete:{Objects:o.map(h=>({Key:this.config.keyPrefix?Y.join(this.config.keyPrefix,h):h}))}};try{return await this.sendCommand(new Te.DeleteObjectsCommand(s))}catch(h){throw this.errorProxy(h,{key,command:s})}}),a={deleted:i,notFound:n};return this.emit("deleteObjects",a,t),a}async listObjects({prefix:t,maxKeys:r=1e3,continuationToken:i}={}){const n={Bucket:this.config.bucket,MaxKeys:r,ContinuationToken:i,Prefix:this.config.keyPrefix?Y.join(this.config.keyPrefix,t||""):t||""};try{const a=await this.sendCommand(new Te.ListObjectsV2Command(n));return this.emit("listObjects",a,n),a}catch(a){throw this.errorProxy(a,{command:n})}}async count({prefix:t}={}){let r=0,i=!0,n;for(;i;){const a={prefix:t,continuationToken:n},o=await this.listObjects(a);r+=o.KeyCount||0,i=o.IsTruncated||!1,n=o.NextContinuationToken}return this.emit("count",r,{prefix:t}),r}async getAllKeys({prefix:t}={}){let r=[],i=!0,n;for(;i;){const a={prefix:t,continuationToken:n},o=await this.listObjects(a);o.Contents&&(r=r.concat(o.Contents.map(s=>s.Key))),i=o.IsTruncated||!1,n=o.NextContinuationToken}return this.config.keyPrefix&&(r=r.map(a=>a.replace(this.config.keyPrefix,"")).map(a=>a.startsWith("/")?a.replace("/",""):a)),this.emit("getAllKeys",r,{prefix:t}),r}async getContinuationTokenAfterOffset(t={}){const{prefix:r,offset:i=1e3}=t;if(i===0)return null;let n=!0,a,o=0;for(;n;){let s=i<1e3?i:i-o>1e3?1e3:i-o;const h={prefix:r,maxKeys:s,continuationToken:a},f=await this.listObjects(h);if(f.Contents&&(o+=f.Contents.length),n=f.IsTruncated||!1,a=f.NextContinuationToken,o>=i)break}return this.emit("getContinuationTokenAfterOffset",a,t),a}async getKeysPage(t={}){const{prefix:r,offset:i=0,amount:n=100}=t;let a=[],o=!0,s;for(i>0&&(s=await this.getContinuationTokenAfterOffset({prefix:r,offset:i}));o;){const h={prefix:r,continuationToken:s},f=await this.listObjects(h);if(f.Contents&&(a=a.concat(f.Contents.map(l=>l.Key))),o=f.IsTruncated||!1,s=f.NextContinuationToken,a.length>n){a=a.splice(0,n);break}}return this.config.keyPrefix&&(a=a.map(h=>h.replace(this.config.keyPrefix,"")).map(h=>h.startsWith("/")?h.replace("/",""):h)),this.emit("getKeysPage",a,t),a}}async function hr(){return P.isObject(process)?(await Promise.resolve().then(function(){return Ia})).webcrypto:window.crypto}async function bi(e,t){const r=await hr(),i=r.getRandomValues(new Uint8Array(16)),n=await xi(t,i),a=r.getRandomValues(new Uint8Array(12)),s=new TextEncoder().encode(e),h=await r.subtle.encrypt({name:"AES-GCM",iv:a},n,s),f=new Uint8Array(i.length+a.length+h.byteLength);return f.set(i),f.set(a,i.length),f.set(new Uint8Array(h),i.length+a.length),io(f)}async function yi(e,t){const r=await hr(),i=no(e),n=i.slice(0,16),a=i.slice(16,28),o=i.slice(28),s=await xi(t,n),h=await r.subtle.decrypt({name:"AES-GCM",iv:a},s,o);return new TextDecoder().decode(h)}async function xi(e,t){const r=await hr(),n=new TextEncoder().encode(e),a=await r.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveKey"]);return await r.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}function io(e){if(P.isObject(process))return Buffer.from(e).toString("base64");{const t=String.fromCharCode.apply(null,new Uint8Array(e));return window.btoa(t)}}function no(e){if(P.isObject(process))return new Uint8Array(Buffer.from(e,"base64"));{const t=window.atob(e),r=t.length,i=new Uint8Array(r);for(let n=0;n<r;n++)i[n]=t.charCodeAt(n);return i}}async function ur(e,t,r){if(!this.passphrase)return t.push({actual:e,type:"encryptionKeyMissing"}),e;try{return await bi(String(e),this.passphrase)}catch(i){t.push({actual:e,type:"encryptionProblem",error:i})}return e}class cr extends za{constructor({options:t,passphrase:r}={}){super(P.merge({},{useNewCustomCheckerFunction:!0,messages:{encryptionKeyMissing:"Missing configuration for secrets encryption.",encryptionProblem:"Problem encrypting secret. Actual: {actual}. Error: {error}"},defaults:{object:{strict:"remove"}}},t)),this.passphrase=r,this.alias("secret",{custom:ur,type:"string",messages:{string:"The '{field}' field must be a string.",stringMin:"This secret '{field}' field length must be at least {expected} long."}}),this.alias("secretAny",{custom:ur,type:"any"}),this.alias("secretNumber",{custom:ur,type:"number"})}}var Ve=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},te=[],G=[],ao=typeof Uint8Array<"u"?Uint8Array:Array,dr=!1;function Ei(){dr=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)te[t]=e[t],G[e.charCodeAt(t)]=t;G[45]=62,G[95]=63}function oo(e){dr||Ei();var t,r,i,n,a,o,s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");a=e[s-2]==="="?2:e[s-1]==="="?1:0,o=new ao(s*3/4-a),i=a>0?s-4:s;var h=0;for(t=0,r=0;t<i;t+=4,r+=3)n=G[e.charCodeAt(t)]<<18|G[e.charCodeAt(t+1)]<<12|G[e.charCodeAt(t+2)]<<6|G[e.charCodeAt(t+3)],o[h++]=n>>16&255,o[h++]=n>>8&255,o[h++]=n&255;return a===2?(n=G[e.charCodeAt(t)]<<2|G[e.charCodeAt(t+1)]>>4,o[h++]=n&255):a===1&&(n=G[e.charCodeAt(t)]<<10|G[e.charCodeAt(t+1)]<<4|G[e.charCodeAt(t+2)]>>2,o[h++]=n>>8&255,o[h++]=n&255),o}function so(e){return te[e>>18&63]+te[e>>12&63]+te[e>>6&63]+te[e&63]}function fo(e,t,r){for(var i,n=[],a=t;a<r;a+=3)i=(e[a]<<16)+(e[a+1]<<8)+e[a+2],n.push(so(i));return n.join("")}function Si(e){dr||Ei();for(var t,r=e.length,i=r%3,n="",a=[],o=16383,s=0,h=r-i;s<h;s+=o)a.push(fo(e,s,s+o>h?h:s+o));return i===1?(t=e[r-1],n+=te[t>>2],n+=te[t<<4&63],n+="=="):i===2&&(t=(e[r-2]<<8)+e[r-1],n+=te[t>>10],n+=te[t>>4&63],n+=te[t<<2&63],n+="="),a.push(n),a.join("")}function Lt(e,t,r,i,n){var a,o,s=n*8-i-1,h=(1<<s)-1,f=h>>1,l=-7,_=r?n-1:0,g=r?-1:1,u=e[t+_];for(_+=g,a=u&(1<<-l)-1,u>>=-l,l+=s;l>0;a=a*256+e[t+_],_+=g,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=i;l>0;o=o*256+e[t+_],_+=g,l-=8);if(a===0)a=1-f;else{if(a===h)return o?NaN:(u?-1:1)*(1/0);o=o+Math.pow(2,i),a=a-f}return(u?-1:1)*o*Math.pow(2,a-i)}function ki(e,t,r,i,n,a){var o,s,h,f=a*8-n-1,l=(1<<f)-1,_=l>>1,g=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,u=i?0:a-1,v=i?1:-1,b=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-o))<1&&(o--,h*=2),o+_>=1?t+=g/h:t+=g*Math.pow(2,1-_),t*h>=2&&(o++,h/=2),o+_>=l?(s=0,o=l):o+_>=1?(s=(t*h-1)*Math.pow(2,n),o=o+_):(s=t*Math.pow(2,_-1)*Math.pow(2,n),o=0));n>=8;e[r+u]=s&255,u+=v,s/=256,n-=8);for(o=o<<n|s,f+=n;f>0;e[r+u]=o&255,u+=v,o/=256,f-=8);e[r+u-v]|=b*128}var lo={}.toString,Ri=Array.isArray||function(e){return lo.call(e)=="[object Array]"};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var ho=50;c.TYPED_ARRAY_SUPPORT=Ve.TYPED_ARRAY_SUPPORT!==void 0?Ve.TYPED_ARRAY_SUPPORT:!0,It();function It(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function oe(e,t){if(It()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=c.prototype):(e===null&&(e=new c(t)),e.length=t),e}function c(e,t,r){if(!c.TYPED_ARRAY_SUPPORT&&!(this instanceof c))return new c(e,t,r);if(typeof e=="number"){if(typeof t=="string")throw new Error("If encoding is specified then the first argument must be a string");return pr(this,e)}return Ai(this,e,t,r)}c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e};function Ai(e,t,r,i){if(typeof t=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer?po(e,t,r,i):typeof t=="string"?co(e,t,r):_o(e,t)}c.from=function(e,t,r){return Ai(null,e,t,r)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&c[Symbol.species]);function Ti(e){if(typeof e!="number")throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function uo(e,t,r,i){return Ti(t),t<=0?oe(e,t):r!==void 0?typeof i=="string"?oe(e,t).fill(r,i):oe(e,t).fill(r):oe(e,t)}c.alloc=function(e,t,r){return uo(null,e,t,r)};function pr(e,t){if(Ti(t),e=oe(e,t<0?0:gr(t)|0),!c.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}c.allocUnsafe=function(e){return pr(null,e)},c.allocUnsafeSlow=function(e){return pr(null,e)};function co(e,t,r){if((typeof r!="string"||r==="")&&(r="utf8"),!c.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var i=Ci(t,r)|0;e=oe(e,i);var n=e.write(t,r);return n!==i&&(e=e.slice(0,n)),e}function _r(e,t){var r=t.length<0?0:gr(t.length)|0;e=oe(e,r);for(var i=0;i<r;i+=1)e[i]=t[i]&255;return e}function po(e,t,r,i){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(i||0))throw new RangeError("'length' is out of bounds");return r===void 0&&i===void 0?t=new Uint8Array(t):i===void 0?t=new Uint8Array(t,r):t=new Uint8Array(t,r,i),c.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=c.prototype):e=_r(e,t),e}function _o(e,t){if(re(t)){var r=gr(t.length)|0;return e=oe(e,r),e.length===0||t.copy(e,0,0,r),e}if(t){if(typeof ArrayBuffer<"u"&&t.buffer instanceof ArrayBuffer||"length"in t)return typeof t.length!="number"||Fo(t.length)?oe(e,0):_r(e,t);if(t.type==="Buffer"&&Ri(t.data))return _r(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function gr(e){if(e>=It())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+It().toString(16)+" bytes");return e|0}c.isBuffer=Do;function re(e){return!!(e!=null&&e._isBuffer)}c.compare=function(t,r){if(!re(t)||!re(r))throw new TypeError("Arguments must be Buffers");if(t===r)return 0;for(var i=t.length,n=r.length,a=0,o=Math.min(i,n);a<o;++a)if(t[a]!==r[a]){i=t[a],n=r[a];break}return i<n?-1:n<i?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,r){if(!Ri(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return c.alloc(0);var i;if(r===void 0)for(r=0,i=0;i<t.length;++i)r+=t[i].length;var n=c.allocUnsafe(r),a=0;for(i=0;i<t.length;++i){var o=t[i];if(!re(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,a),a+=o.length}return n};function Ci(e,t){if(re(e))return e.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;typeof e!="string"&&(e=""+e);var r=e.length;if(r===0)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Ft(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return Bi(e).length;default:if(i)return Ft(e).length;t=(""+t).toLowerCase(),i=!0}}c.byteLength=Ci;function go(e,t,r){var i=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,t>>>=0,r<=t))return"";for(e||(e="utf8");;)switch(e){case"hex":return Ro(this,t,r);case"utf8":case"utf-8":return Oi(this,t,r);case"ascii":return So(this,t,r);case"latin1":case"binary":return ko(this,t,r);case"base64":return xo(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ao(this,t,r);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}c.prototype._isBuffer=!0;function Ce(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}c.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)Ce(this,r,r+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)Ce(this,r,r+3),Ce(this,r+1,r+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)Ce(this,r,r+7),Ce(this,r+1,r+6),Ce(this,r+2,r+5),Ce(this,r+3,r+4);return this},c.prototype.toString=function(){var t=this.length|0;return t===0?"":arguments.length===0?Oi(this,0,t):go.apply(this,arguments)},c.prototype.equals=function(t){if(!re(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:c.compare(this,t)===0},c.prototype.inspect=function(){var t="",r=ho;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,r,i,n,a){if(!re(t))throw new TypeError("Argument must be a Buffer");if(r===void 0&&(r=0),i===void 0&&(i=t?t.length:0),n===void 0&&(n=0),a===void 0&&(a=this.length),r<0||i>t.length||n<0||a>this.length)throw new RangeError("out of range index");if(n>=a&&r>=i)return 0;if(n>=a)return-1;if(r>=i)return 1;if(r>>>=0,i>>>=0,n>>>=0,a>>>=0,this===t)return 0;for(var o=a-n,s=i-r,h=Math.min(o,s),f=this.slice(n,a),l=t.slice(r,i),_=0;_<h;++_)if(f[_]!==l[_]){o=f[_],s=l[_];break}return o<s?-1:s<o?1:0};function Li(e,t,r,i,n){if(e.length===0)return-1;if(typeof r=="string"?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0)if(n)r=0;else return-1;if(typeof t=="string"&&(t=c.from(t,i)),re(t))return t.length===0?-1:Ii(e,t,r,i,n);if(typeof t=="number")return t=t&255,c.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):Ii(e,[t],r,i,n);throw new TypeError("val must be string, number or Buffer")}function Ii(e,t,r,i,n){var a=1,o=e.length,s=t.length;if(i!==void 0&&(i=String(i).toLowerCase(),i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le")){if(e.length<2||t.length<2)return-1;a=2,o/=2,s/=2,r/=2}function h(u,v){return a===1?u[v]:u.readUInt16BE(v*a)}var f;if(n){var l=-1;for(f=r;f<o;f++)if(h(e,f)===h(t,l===-1?0:f-l)){if(l===-1&&(l=f),f-l+1===s)return l*a}else l!==-1&&(f-=f-l),l=-1}else for(r+s>o&&(r=o-s),f=r;f>=0;f--){for(var _=!0,g=0;g<s;g++)if(h(e,f+g)!==h(t,g)){_=!1;break}if(_)return f}return-1}c.prototype.includes=function(t,r,i){return this.indexOf(t,r,i)!==-1},c.prototype.indexOf=function(t,r,i){return Li(this,t,r,i,!0)},c.prototype.lastIndexOf=function(t,r,i){return Li(this,t,r,i,!1)};function wo(e,t,r,i){r=Number(r)||0;var n=e.length-r;i?(i=Number(i),i>n&&(i=n)):i=n;var a=t.length;if(a%2!==0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var o=0;o<i;++o){var s=parseInt(t.substr(o*2,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function vo(e,t,r,i){return Dt(Ft(t,e.length-r),e,r,i)}function Mi(e,t,r,i){return Dt(Mo(t),e,r,i)}function mo(e,t,r,i){return Mi(e,t,r,i)}function bo(e,t,r,i){return Dt(Bi(t),e,r,i)}function yo(e,t,r,i){return Dt(Oo(t,e.length-r),e,r,i)}c.prototype.write=function(t,r,i,n){if(r===void 0)n="utf8",i=this.length,r=0;else if(i===void 0&&typeof r=="string")n=r,i=this.length,r=0;else if(isFinite(r))r=r|0,isFinite(i)?(i=i|0,n===void 0&&(n="utf8")):(n=i,i=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var a=this.length-r;if((i===void 0||i>a)&&(i=a),t.length>0&&(i<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return wo(this,t,r,i);case"utf8":case"utf-8":return vo(this,t,r,i);case"ascii":return Mi(this,t,r,i);case"latin1":case"binary":return mo(this,t,r,i);case"base64":return bo(this,t,r,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return yo(this,t,r,i);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function xo(e,t,r){return t===0&&r===e.length?Si(e):Si(e.slice(t,r))}function Oi(e,t,r){r=Math.min(e.length,r);for(var i=[],n=t;n<r;){var a=e[n],o=null,s=a>239?4:a>223?3:a>191?2:1;if(n+s<=r){var h,f,l,_;switch(s){case 1:a<128&&(o=a);break;case 2:h=e[n+1],(h&192)===128&&(_=(a&31)<<6|h&63,_>127&&(o=_));break;case 3:h=e[n+1],f=e[n+2],(h&192)===128&&(f&192)===128&&(_=(a&15)<<12|(h&63)<<6|f&63,_>2047&&(_<55296||_>57343)&&(o=_));break;case 4:h=e[n+1],f=e[n+2],l=e[n+3],(h&192)===128&&(f&192)===128&&(l&192)===128&&(_=(a&15)<<18|(h&63)<<12|(f&63)<<6|l&63,_>65535&&_<1114112&&(o=_))}}o===null?(o=65533,s=1):o>65535&&(o-=65536,i.push(o>>>10&1023|55296),o=56320|o&1023),i.push(o),n+=s}return Eo(i)}var Fi=4096;function Eo(e){var t=e.length;if(t<=Fi)return String.fromCharCode.apply(String,e);for(var r="",i=0;i<t;)r+=String.fromCharCode.apply(String,e.slice(i,i+=Fi));return r}function So(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]&127);return i}function ko(e,t,r){var i="";r=Math.min(e.length,r);for(var n=t;n<r;++n)i+=String.fromCharCode(e[n]);return i}function Ro(e,t,r){var i=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>i)&&(r=i);for(var n="",a=t;a<r;++a)n+=Io(e[a]);return n}function Ao(e,t,r){for(var i=e.slice(t,r),n="",a=0;a<i.length;a+=2)n+=String.fromCharCode(i[a]+i[a+1]*256);return n}c.prototype.slice=function(t,r){var i=this.length;t=~~t,r=r===void 0?i:~~r,t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),r<0?(r+=i,r<0&&(r=0)):r>i&&(r=i),r<t&&(r=t);var n;if(c.TYPED_ARRAY_SUPPORT)n=this.subarray(t,r),n.__proto__=c.prototype;else{var a=r-t;n=new c(a,void 0);for(var o=0;o<a;++o)n[o]=this[o+t]}return n};function B(e,t,r){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUIntLE=function(t,r,i){t=t|0,r=r|0,i||B(t,r,this.length);for(var n=this[t],a=1,o=0;++o<r&&(a*=256);)n+=this[t+o]*a;return n},c.prototype.readUIntBE=function(t,r,i){t=t|0,r=r|0,i||B(t,r,this.length);for(var n=this[t+--r],a=1;r>0&&(a*=256);)n+=this[t+--r]*a;return n},c.prototype.readUInt8=function(t,r){return r||B(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,r){return r||B(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,r){return r||B(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,r){return r||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},c.prototype.readUInt32BE=function(t,r){return r||B(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,r,i){t=t|0,r=r|0,i||B(t,r,this.length);for(var n=this[t],a=1,o=0;++o<r&&(a*=256);)n+=this[t+o]*a;return a*=128,n>=a&&(n-=Math.pow(2,8*r)),n},c.prototype.readIntBE=function(t,r,i){t=t|0,r=r|0,i||B(t,r,this.length);for(var n=r,a=1,o=this[t+--n];n>0&&(a*=256);)o+=this[t+--n]*a;return a*=128,o>=a&&(o-=Math.pow(2,8*r)),o},c.prototype.readInt8=function(t,r){return r||B(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},c.prototype.readInt16LE=function(t,r){r||B(t,2,this.length);var i=this[t]|this[t+1]<<8;return i&32768?i|4294901760:i},c.prototype.readInt16BE=function(t,r){r||B(t,2,this.length);var i=this[t+1]|this[t]<<8;return i&32768?i|4294901760:i},c.prototype.readInt32LE=function(t,r){return r||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,r){return r||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,r){return r||B(t,4,this.length),Lt(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,r){return r||B(t,4,this.length),Lt(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,r){return r||B(t,8,this.length),Lt(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,r){return r||B(t,8,this.length),Lt(this,t,!1,52,8)};function H(e,t,r,i,n,a){if(!re(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<a)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}c.prototype.writeUIntLE=function(t,r,i,n){if(t=+t,r=r|0,i=i|0,!n){var a=Math.pow(2,8*i)-1;H(this,t,r,i,a,0)}var o=1,s=0;for(this[r]=t&255;++s<i&&(o*=256);)this[r+s]=t/o&255;return r+i},c.prototype.writeUIntBE=function(t,r,i,n){if(t=+t,r=r|0,i=i|0,!n){var a=Math.pow(2,8*i)-1;H(this,t,r,i,a,0)}var o=i-1,s=1;for(this[r+o]=t&255;--o>=0&&(s*=256);)this[r+o]=t/s&255;return r+i},c.prototype.writeUInt8=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=t&255,r+1};function Mt(e,t,r,i){t<0&&(t=65535+t+1);for(var n=0,a=Math.min(e.length-r,2);n<a;++n)e[r+n]=(t&255<<8*(i?n:1-n))>>>(i?n:1-n)*8}c.prototype.writeUInt16LE=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[r]=t&255,this[r+1]=t>>>8):Mt(this,t,r,!0),r+2},c.prototype.writeUInt16BE=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=t&255):Mt(this,t,r,!1),r+2};function Ot(e,t,r,i){t<0&&(t=4294967295+t+1);for(var n=0,a=Math.min(e.length-r,4);n<a;++n)e[r+n]=t>>>(i?n:3-n)*8&255}c.prototype.writeUInt32LE=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=t&255):Ot(this,t,r,!0),r+4},c.prototype.writeUInt32BE=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255):Ot(this,t,r,!1),r+4},c.prototype.writeIntLE=function(t,r,i,n){if(t=+t,r=r|0,!n){var a=Math.pow(2,8*i-1);H(this,t,r,i,a-1,-a)}var o=0,s=1,h=0;for(this[r]=t&255;++o<i&&(s*=256);)t<0&&h===0&&this[r+o-1]!==0&&(h=1),this[r+o]=(t/s>>0)-h&255;return r+i},c.prototype.writeIntBE=function(t,r,i,n){if(t=+t,r=r|0,!n){var a=Math.pow(2,8*i-1);H(this,t,r,i,a-1,-a)}var o=i-1,s=1,h=0;for(this[r+o]=t&255;--o>=0&&(s*=256);)t<0&&h===0&&this[r+o+1]!==0&&(h=1),this[r+o]=(t/s>>0)-h&255;return r+i},c.prototype.writeInt8=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[r]=t&255,r+1},c.prototype.writeInt16LE=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[r]=t&255,this[r+1]=t>>>8):Mt(this,t,r,!0),r+2},c.prototype.writeInt16BE=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=t&255):Mt(this,t,r,!1),r+2},c.prototype.writeInt32LE=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[r]=t&255,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24):Ot(this,t,r,!0),r+4},c.prototype.writeInt32BE=function(t,r,i){return t=+t,r=r|0,i||H(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255):Ot(this,t,r,!1),r+4};function Di(e,t,r,i,n,a){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Ni(e,t,r,i,n){return n||Di(e,t,r,4),ki(e,t,r,i,23,4),r+4}c.prototype.writeFloatLE=function(t,r,i){return Ni(this,t,r,!0,i)},c.prototype.writeFloatBE=function(t,r,i){return Ni(this,t,r,!1,i)};function zi(e,t,r,i,n){return n||Di(e,t,r,8),ki(e,t,r,i,52,8),r+8}c.prototype.writeDoubleLE=function(t,r,i){return zi(this,t,r,!0,i)},c.prototype.writeDoubleBE=function(t,r,i){return zi(this,t,r,!1,i)},c.prototype.copy=function(t,r,i,n){if(i||(i=0),!n&&n!==0&&(n=this.length),r>=t.length&&(r=t.length),r||(r=0),n>0&&n<i&&(n=i),n===i||t.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-r<n-i&&(n=t.length-r+i);var a=n-i,o;if(this===t&&i<r&&r<n)for(o=a-1;o>=0;--o)t[o+r]=this[o+i];else if(a<1e3||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<a;++o)t[o+r]=this[o+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+a),r);return a},c.prototype.fill=function(t,r,i,n){if(typeof t=="string"){if(typeof r=="string"?(n=r,r=0,i=this.length):typeof i=="string"&&(n=i,i=this.length),t.length===1){var a=t.charCodeAt(0);a<256&&(t=a)}if(n!==void 0&&typeof n!="string")throw new TypeError("encoding must be a string");if(typeof n=="string"&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else typeof t=="number"&&(t=t&255);if(r<0||this.length<r||this.length<i)throw new RangeError("Out of range index");if(i<=r)return this;r=r>>>0,i=i===void 0?this.length:i>>>0,t||(t=0);var o;if(typeof t=="number")for(o=r;o<i;++o)this[o]=t;else{var s=re(t)?t:Ft(new c(t,n).toString()),h=s.length;for(o=0;o<i-r;++o)this[o+r]=s[o%h]}return this};var To=/[^+\/0-9A-Za-z-_]/g;function Co(e){if(e=Lo(e).replace(To,""),e.length<2)return"";for(;e.length%4!==0;)e=e+"=";return e}function Lo(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Io(e){return e<16?"0"+e.toString(16):e.toString(16)}function Ft(e,t){t=t||1/0;for(var r,i=e.length,n=null,a=[],o=0;o<i;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!n){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}else if(o+1===i){(t-=3)>-1&&a.push(239,191,189);continue}n=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),n=r;continue}r=(n-55296<<10|r-56320)+65536}else n&&(t-=3)>-1&&a.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return a}function Mo(e){for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r)&255);return t}function Oo(e,t){for(var r,i,n,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),i=r>>8,n=r%256,a.push(n),a.push(i);return a}function Bi(e){return oo(Co(e))}function Dt(e,t,r,i){for(var n=0;n<i&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}function Fo(e){return e!==e}function Do(e){return e!=null&&(!!e._isBuffer||Ui(e)||No(e))}function Ui(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function No(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&Ui(e.slice(0,0))}function Pi(){throw new Error("setTimeout has not been defined")}function Zi(){throw new Error("clearTimeout has not been defined")}var pe=Pi,_e=Zi;typeof Ve.setTimeout=="function"&&(pe=setTimeout),typeof Ve.clearTimeout=="function"&&(_e=clearTimeout);function ji(e){if(pe===setTimeout)return setTimeout(e,0);if((pe===Pi||!pe)&&setTimeout)return pe=setTimeout,setTimeout(e,0);try{return pe(e,0)}catch{try{return pe.call(null,e,0)}catch{return pe.call(this,e,0)}}}function zo(e){if(_e===clearTimeout)return clearTimeout(e);if((_e===Zi||!_e)&&clearTimeout)return _e=clearTimeout,clearTimeout(e);try{return _e(e)}catch{try{return _e.call(null,e)}catch{return _e.call(this,e)}}}var se=[],Xe=!1,Le,Nt=-1;function Bo(){!Xe||!Le||(Xe=!1,Le.length?se=Le.concat(se):Nt=-1,se.length&&$i())}function $i(){if(!Xe){var e=ji(Bo);Xe=!0;for(var t=se.length;t;){for(Le=se,se=[];++Nt<t;)Le&&Le[Nt].run();Nt=-1,t=se.length}Le=null,Xe=!1,zo(e)}}function q(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];se.push(new Hi(e,t)),se.length===1&&!Xe&&ji($i)}function Hi(e,t){this.fun=e,this.array=t}Hi.prototype.run=function(){this.fun.apply(null,this.array)};var Uo="browser",Po="browser",Zo=!0,jo={},$o=[],Ho="",Wo={},Ko={},Yo={};function Ie(){}var qo=Ie,Go=Ie,Vo=Ie,Xo=Ie,Jo=Ie,Qo=Ie,es=Ie;function ts(e){throw new Error("process.binding is not supported")}function rs(){return"/"}function is(e){throw new Error("process.chdir is not supported")}function ns(){return 0}var Je=Ve.performance||{},as=Je.now||Je.mozNow||Je.msNow||Je.oNow||Je.webkitNow||function(){return new Date().getTime()};function os(e){var t=as.call(Je)*.001,r=Math.floor(t),i=Math.floor(t%1*1e9);return e&&(r=r-e[0],i=i-e[1],i<0&&(r--,i+=1e9)),[r,i]}var ss=new Date;function fs(){var e=new Date,t=e-ss;return t/1e3}var fe={nextTick:q,title:Uo,browser:Zo,env:jo,argv:$o,version:Ho,versions:Wo,on:qo,addListener:Go,once:Vo,off:Xo,removeListener:Jo,removeAllListeners:Qo,emit:es,binding:ts,cwd:rs,chdir:is,umask:ns,hrtime:os,platform:Po,release:Ko,config:Yo,uptime:fs},j;typeof Object.create=="function"?j=function(t,r){t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:j=function(t,r){t.super_=r;var i=function(){};i.prototype=r.prototype,t.prototype=new i,t.prototype.constructor=t};var ls=/%[sdj%]/g;function hs(e){if(!yr(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(ge(arguments[r]));return t.join(" ")}for(var r=1,i=arguments,n=i.length,a=String(e).replace(ls,function(s){if(s==="%%")return"%";if(r>=n)return s;switch(s){case"%s":return String(i[r++]);case"%d":return Number(i[r++]);case"%j":try{return JSON.stringify(i[r++])}catch{return"[Circular]"}default:return s}}),o=i[r];r<n;o=i[++r])br(o)||!ft(o)?a+=" "+o:a+=" "+ge(o);return a}function Wi(e,t){if(we(Ve.process))return function(){return Wi(e,t).apply(this,arguments)};if(fe.noDeprecation===!0)return e;var r=!1;function i(){if(!r){if(fe.throwDeprecation)throw new Error(t);fe.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)}return i}var zt={},wr;function us(e){if(we(wr)&&(wr=fe.env.NODE_DEBUG||""),e=e.toUpperCase(),!zt[e])if(new RegExp("\\b"+e+"\\b","i").test(wr)){var t=0;zt[e]=function(){var r=hs.apply(null,arguments);console.error("%s %d: %s",e,t,r)}}else zt[e]=function(){};return zt[e]}function ge(e,t){var r={seen:[],stylize:ds};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),Ki(t)?r.showHidden=t:t&&bs(r,t),we(r.showHidden)&&(r.showHidden=!1),we(r.depth)&&(r.depth=2),we(r.colors)&&(r.colors=!1),we(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=cs),Bt(r,e,r.depth)}ge.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},ge.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function cs(e,t){var r=ge.styles[t];return r?"\x1B["+ge.colors[r][0]+"m"+e+"\x1B["+ge.colors[r][1]+"m":e}function ds(e,t){return e}function ps(e){var t={};return e.forEach(function(r,i){t[r]=!0}),t}function Bt(e,t,r){if(e.customInspect&&t&&Sr(t.inspect)&&t.inspect!==ge&&!(t.constructor&&t.constructor.prototype===t)){var i=t.inspect(r,e);return yr(i)||(i=Bt(e,i,r)),i}var n=_s(e,t);if(n)return n;var a=Object.keys(t),o=ps(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),Er(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return vr(t);if(a.length===0){if(Sr(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(xr(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Yi(t))return e.stylize(Date.prototype.toString.call(t),"date");if(Er(t))return vr(t)}var h="",f=!1,l=["{","}"];if(vs(t)&&(f=!0,l=["[","]"]),Sr(t)){var _=t.name?": "+t.name:"";h=" [Function"+_+"]"}if(xr(t)&&(h=" "+RegExp.prototype.toString.call(t)),Yi(t)&&(h=" "+Date.prototype.toUTCString.call(t)),Er(t)&&(h=" "+vr(t)),a.length===0&&(!f||t.length==0))return l[0]+h+l[1];if(r<0)return xr(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var g;return f?g=gs(e,t,r,o,a):g=a.map(function(u){return mr(e,t,r,o,u,f)}),e.seen.pop(),ws(g,h,l)}function _s(e,t){if(we(t))return e.stylize("undefined","undefined");if(yr(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(ms(t))return e.stylize(""+t,"number");if(Ki(t))return e.stylize(""+t,"boolean");if(br(t))return e.stylize("null","null")}function vr(e){return"["+Error.prototype.toString.call(e)+"]"}function gs(e,t,r,i,n){for(var a=[],o=0,s=t.length;o<s;++o)qi(t,String(o))?a.push(mr(e,t,r,i,String(o),!0)):a.push("");return n.forEach(function(h){h.match(/^\d+$/)||a.push(mr(e,t,r,i,h,!0))}),a}function mr(e,t,r,i,n,a){var o,s,h;if(h=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]},h.get?h.set?s=e.stylize("[Getter/Setter]","special"):s=e.stylize("[Getter]","special"):h.set&&(s=e.stylize("[Setter]","special")),qi(i,n)||(o="["+n+"]"),s||(e.seen.indexOf(h.value)<0?(br(r)?s=Bt(e,h.value,null):s=Bt(e,h.value,r-1),s.indexOf(`
`)>-1&&(a?s=s.split(`
`).map(function(f){return"  "+f}).join(`
`).substr(2):s=`
`+s.split(`
`).map(function(f){return"   "+f}).join(`
`))):s=e.stylize("[Circular]","special")),we(o)){if(a&&n.match(/^\d+$/))return s;o=JSON.stringify(""+n),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function ws(e,t,r){var i=e.reduce(function(n,a){return a.indexOf(`
`)>=0,n+a.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?r[0]+(t===""?"":t+`
 `)+" "+e.join(`,
  `)+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function vs(e){return Array.isArray(e)}function Ki(e){return typeof e=="boolean"}function br(e){return e===null}function ms(e){return typeof e=="number"}function yr(e){return typeof e=="string"}function we(e){return e===void 0}function xr(e){return ft(e)&&kr(e)==="[object RegExp]"}function ft(e){return typeof e=="object"&&e!==null}function Yi(e){return ft(e)&&kr(e)==="[object Date]"}function Er(e){return ft(e)&&(kr(e)==="[object Error]"||e instanceof Error)}function Sr(e){return typeof e=="function"}function kr(e){return Object.prototype.toString.call(e)}function bs(e,t){if(!t||!ft(t))return e;for(var r=Object.keys(t),i=r.length;i--;)e[r[i]]=t[r[i]];return e}function qi(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Me(){this.head=null,this.tail=null,this.length=0}Me.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},Me.prototype.unshift=function(e){var t={data:e,next:this.head};this.length===0&&(this.tail=t),this.head=t,++this.length},Me.prototype.shift=function(){if(this.length!==0){var e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},Me.prototype.clear=function(){this.head=this.tail=null,this.length=0},Me.prototype.join=function(e){if(this.length===0)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},Me.prototype.concat=function(e){if(this.length===0)return c.alloc(0);if(this.length===1)return this.head.data;for(var t=c.allocUnsafe(e>>>0),r=this.head,i=0;r;)r.data.copy(t,i),i+=r.data.length,r=r.next;return t};var ys=c.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function xs(e){if(e&&!ys(e))throw new Error("Unknown encoding: "+e)}function lt(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),xs(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=Ss;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=ks;break;default:this.write=Es;return}this.charBuffer=new c(6),this.charReceived=0,this.charLength=0}lt.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";e=e.slice(r,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var n=t.charCodeAt(t.length-1);if(n>=55296&&n<=56319){this.charLength+=this.surrogateSize,t="";continue}if(this.charReceived=this.charLength=0,e.length===0)return t;break}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,n=t.charCodeAt(i);if(n>=55296&&n<=56319){var a=this.surrogateSize;return this.charLength+=a,this.charReceived+=a,this.charBuffer.copy(this.charBuffer,a,0,a),e.copy(this.charBuffer,0,0,a),t.substring(0,i)}return t},lt.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(t==1&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},lt.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,i=this.charBuffer,n=this.encoding;t+=i.slice(0,r).toString(n)}return t};function Es(e){return e.toString(this.encoding)}function Ss(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function ks(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}N.ReadableState=Gi;var M=us("stream");j(N,C);function Rs(e,t,r){if(typeof e.prependListener=="function")return e.prependListener(t,r);!e._events||!e._events[t]?e.on(t,r):Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]}function As(e,t){return e.listeners(t).length}function Gi(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof V&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16*1024;this.highWaterMark=r||r===0?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new Me,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new lt(e.encoding),this.encoding=e.encoding)}function N(e){if(!(this instanceof N))return new N(e);this._readableState=new Gi(e,this),this.readable=!0,e&&typeof e.read=="function"&&(this._read=e.read),C.call(this)}N.prototype.push=function(e,t){var r=this._readableState;return!r.objectMode&&typeof e=="string"&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=c.from(e,t),t="")),Vi(this,r,e,t,!1)},N.prototype.unshift=function(e){var t=this._readableState;return Vi(this,t,e,"",!0)},N.prototype.isPaused=function(){return this._readableState.flowing===!1};function Vi(e,t,r,i,n){var a=Ls(t,r);if(a)e.emit("error",a);else if(r===null)t.reading=!1,Is(e,t);else if(t.objectMode||r&&r.length>0)if(t.ended&&!n){var o=new Error("stream.push() after EOF");e.emit("error",o)}else if(t.endEmitted&&n){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else{var h;t.decoder&&!n&&!i&&(r=t.decoder.write(r),h=!t.objectMode&&r.length===0),n||(t.reading=!1),h||(t.flowing&&t.length===0&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&Ut(e))),Ms(e,t)}else n||(t.reading=!1);return Ts(t)}function Ts(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||e.length===0)}N.prototype.setEncoding=function(e){return this._readableState.decoder=new lt(e),this._readableState.encoding=e,this};var Xi=8388608;function Cs(e){return e>=Xi?e=Xi:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function Ji(e,t){return e<=0||t.length===0&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=Cs(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}N.prototype.read=function(e){M("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(e!==0&&(t.emittedReadable=!1),e===0&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return M("read: emitReadable",t.length,t.ended),t.length===0&&t.ended?Ar(this):Ut(this),null;if(e=Ji(e,t),e===0&&t.ended)return t.length===0&&Ar(this),null;var i=t.needReadable;M("need readable",i),(t.length===0||t.length-e<t.highWaterMark)&&(i=!0,M("length less than watermark",i)),t.ended||t.reading?(i=!1,M("reading or ended",i)):i&&(M("do read"),t.reading=!0,t.sync=!0,t.length===0&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=Ji(r,t)));var n;return e>0?n=en(e,t):n=null,n===null?(t.needReadable=!0,e=0):t.length-=e,t.length===0&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&Ar(this)),n!==null&&this.emit("data",n),n};function Ls(e,t){var r=null;return!c.isBuffer(t)&&typeof t!="string"&&t!==null&&t!==void 0&&!e.objectMode&&(r=new TypeError("Invalid non-string/buffer chunk")),r}function Is(e,t){if(!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,Ut(e)}}function Ut(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(M("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?q(Qi,e):Qi(e))}function Qi(e){M("emit readable"),e.emit("readable"),Rr(e)}function Ms(e,t){t.readingMore||(t.readingMore=!0,q(Os,e,t))}function Os(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(M("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}N.prototype._read=function(e){this.emit("error",new Error("not implemented"))},N.prototype.pipe=function(e,t){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e);break}i.pipesCount+=1,M("pipe count=%d opts=%j",i.pipesCount,t);var n=!t||t.end!==!1,a=n?s:l;i.endEmitted?q(a):r.once("end",a),e.on("unpipe",o);function o(E){M("onunpipe"),E===r&&l()}function s(){M("onend"),e.end()}var h=Fs(r);e.on("drain",h);var f=!1;function l(){M("cleanup"),e.removeListener("close",v),e.removeListener("finish",b),e.removeListener("drain",h),e.removeListener("error",u),e.removeListener("unpipe",o),r.removeListener("end",s),r.removeListener("end",l),r.removeListener("data",g),f=!0,i.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&h()}var _=!1;r.on("data",g);function g(E){M("ondata"),_=!1;var d=e.write(E);d===!1&&!_&&((i.pipesCount===1&&i.pipes===e||i.pipesCount>1&&tn(i.pipes,e)!==-1)&&!f&&(M("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,_=!0),r.pause())}function u(E){M("onerror",E),y(),e.removeListener("error",u),As(e,"error")===0&&e.emit("error",E)}Rs(e,"error",u);function v(){e.removeListener("finish",b),y()}e.once("close",v);function b(){M("onfinish"),e.removeListener("close",v),y()}e.once("finish",b);function y(){M("unpipe"),r.unpipe(e)}return e.emit("pipe",r),i.flowing||(M("pipe resume"),r.resume()),e};function Fs(e){return function(){var t=e._readableState;M("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,t.awaitDrain===0&&e.listeners("data").length&&(t.flowing=!0,Rr(e))}}N.prototype.unpipe=function(e){var t=this._readableState;if(t.pipesCount===0)return this;if(t.pipesCount===1)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var n=0;n<i;n++)r[n].emit("unpipe",this);return this}var a=tn(t.pipes,e);return a===-1?this:(t.pipes.splice(a,1),t.pipesCount-=1,t.pipesCount===1&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},N.prototype.on=function(e,t){var r=C.prototype.on.call(this,e,t);if(e==="data")this._readableState.flowing!==!1&&this.resume();else if(e==="readable"){var i=this._readableState;!i.endEmitted&&!i.readableListening&&(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&Ut(this):q(Ds,this))}return r},N.prototype.addListener=N.prototype.on;function Ds(e){M("readable nexttick read 0"),e.read(0)}N.prototype.resume=function(){var e=this._readableState;return e.flowing||(M("resume"),e.flowing=!0,Ns(this,e)),this};function Ns(e,t){t.resumeScheduled||(t.resumeScheduled=!0,q(zs,e,t))}function zs(e,t){t.reading||(M("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),Rr(e),t.flowing&&!t.reading&&e.read(0)}N.prototype.pause=function(){return M("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(M("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function Rr(e){var t=e._readableState;for(M("flow",t.flowing);t.flowing&&e.read()!==null;);}N.prototype.wrap=function(e){var t=this._readableState,r=!1,i=this;e.on("end",function(){if(M("wrapped end"),t.decoder&&!t.ended){var o=t.decoder.end();o&&o.length&&i.push(o)}i.push(null)}),e.on("data",function(o){if(M("wrapped data"),t.decoder&&(o=t.decoder.write(o)),!(t.objectMode&&o==null)&&!(!t.objectMode&&(!o||!o.length))){var s=i.push(o);s||(r=!0,e.pause())}});for(var n in e)this[n]===void 0&&typeof e[n]=="function"&&(this[n]=function(o){return function(){return e[o].apply(e,arguments)}}(n));var a=["error","close","destroy","pause","resume"];return js(a,function(o){e.on(o,i.emit.bind(i,o))}),i._read=function(o){M("wrapped _read",o),r&&(r=!1,e.resume())},i},N._fromList=en;function en(e,t){if(t.length===0)return null;var r;return t.objectMode?r=t.buffer.shift():!e||e>=t.length?(t.decoder?r=t.buffer.join(""):t.buffer.length===1?r=t.buffer.head.data:r=t.buffer.concat(t.length),t.buffer.clear()):r=Bs(e,t.buffer,t.decoder),r}function Bs(e,t,r){var i;return e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):e===t.head.data.length?i=t.shift():i=r?Us(e,t):Ps(e,t),i}function Us(e,t){var r=t.head,i=1,n=r.data;for(e-=n.length;r=r.next;){var a=r.data,o=e>a.length?a.length:e;if(o===a.length?n+=a:n+=a.slice(0,e),e-=o,e===0){o===a.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=a.slice(o));break}++i}return t.length-=i,n}function Ps(e,t){var r=c.allocUnsafe(e),i=t.head,n=1;for(i.data.copy(r),e-=i.data.length;i=i.next;){var a=i.data,o=e>a.length?a.length:e;if(a.copy(r,r.length-e,0,o),e-=o,e===0){o===a.length?(++n,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=a.slice(o));break}++n}return t.length-=n,r}function Ar(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,q(Zs,t,e))}function Zs(e,t){!e.endEmitted&&e.length===0&&(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function js(e,t){for(var r=0,i=e.length;r<i;r++)t(e[r],r)}function tn(e,t){for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}$.WritableState=Tr,j($,C);function $s(){}function Hs(e,t,r){this.chunk=e,this.encoding=t,this.callback=r,this.next=null}function Tr(e,t){Object.defineProperty(this,"buffer",{get:Wi(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof V&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16*1024;this.highWaterMark=r||r===0?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var n=e.decodeStrings===!1;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){Xs(t,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new fn(this)}Tr.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r};function $(e){if(!(this instanceof $)&&!(this instanceof V))return new $(e);this._writableState=new Tr(e,this),this.writable=!0,e&&(typeof e.write=="function"&&(this._write=e.write),typeof e.writev=="function"&&(this._writev=e.writev)),C.call(this)}$.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function Ws(e,t){var r=new Error("write after end");e.emit("error",r),q(t,r)}function Ks(e,t,r,i){var n=!0,a=!1;return r===null?a=new TypeError("May not write null values to stream"):!c.isBuffer(r)&&typeof r!="string"&&r!==void 0&&!t.objectMode&&(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),q(i,a),n=!1),n}$.prototype.write=function(e,t,r){var i=this._writableState,n=!1;return typeof t=="function"&&(r=t,t=null),c.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),typeof r!="function"&&(r=$s),i.ended?Ws(this,r):Ks(this,i,e,r)&&(i.pendingcb++,n=qs(this,i,e,t,r)),n},$.prototype.cork=function(){var e=this._writableState;e.corked++},$.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.finished&&!e.bufferProcessing&&e.bufferedRequest&&nn(this,e))},$.prototype.setDefaultEncoding=function(t){if(typeof t=="string"&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this};function Ys(e,t,r){return!e.objectMode&&e.decodeStrings!==!1&&typeof t=="string"&&(t=c.from(t,r)),t}function qs(e,t,r,i,n){r=Ys(t,r,i),c.isBuffer(r)&&(i="buffer");var a=t.objectMode?1:r.length;t.length+=a;var o=t.length<t.highWaterMark;if(o||(t.needDrain=!0),t.writing||t.corked){var s=t.lastBufferedRequest;t.lastBufferedRequest=new Hs(r,i,n),s?s.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else Cr(e,t,!1,a,r,i,n);return o}function Cr(e,t,r,i,n,a,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,r?e._writev(n,t.onwrite):e._write(n,a,t.onwrite),t.sync=!1}function Gs(e,t,r,i,n){--t.pendingcb,r?q(n,i):n(i),e._writableState.errorEmitted=!0,e.emit("error",i)}function Vs(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function Xs(e,t){var r=e._writableState,i=r.sync,n=r.writecb;if(Vs(r),t)Gs(e,r,i,t,n);else{var a=an(r);!a&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&nn(e,r),i?q(rn,e,r,a,n):rn(e,r,a,n)}}function rn(e,t,r,i){r||Js(e,t),t.pendingcb--,i(),sn(e,t)}function Js(e,t){t.length===0&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function nn(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,n=new Array(i),a=t.corkedRequestsFree;a.entry=r;for(var o=0;r;)n[o]=r,r=r.next,o+=1;Cr(e,t,!0,t.length,n,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new fn(t)}else{for(;r;){var s=r.chunk,h=r.encoding,f=r.callback,l=t.objectMode?1:s.length;if(Cr(e,t,!1,l,s,h,f),r=r.next,t.writing)break}r===null&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}$.prototype._write=function(e,t,r){r(new Error("not implemented"))},$.prototype._writev=null,$.prototype.end=function(e,t,r){var i=this._writableState;typeof e=="function"?(r=e,e=null,t=null):typeof t=="function"&&(r=t,t=null),e!=null&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),!i.ending&&!i.finished&&Qs(this,i,r)};function an(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function on(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function sn(e,t){var r=an(t);return r&&(t.pendingcb===0?(on(e,t),t.finished=!0,e.emit("finish")):on(e,t)),r}function Qs(e,t,r){t.ending=!0,sn(e,t),r&&(t.finished?q(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function fn(e){var t=this;this.next=null,this.entry=null,this.finish=function(r){var i=t.entry;for(t.entry=null;i;){var n=i.callback;e.pendingcb--,n(r),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}j(V,N);for(var ln=Object.keys($.prototype),Lr=0;Lr<ln.length;Lr++){var Ir=ln[Lr];V.prototype[Ir]||(V.prototype[Ir]=$.prototype[Ir])}function V(e){if(!(this instanceof V))return new V(e);N.call(this,e),$.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",ef)}function ef(){this.allowHalfOpen||this._writableState.ended||q(tf,this)}function tf(e){e.end()}j(X,V);function rf(e){this.afterTransform=function(t,r){return nf(e,t,r)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function nf(e,t,r){var i=e._transformState;i.transforming=!1;var n=i.writecb;if(!n)return e.emit("error",new Error("no writecb in Transform class"));i.writechunk=null,i.writecb=null,r!=null&&e.push(r),n(t);var a=e._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&e._read(a.highWaterMark)}function X(e){if(!(this instanceof X))return new X(e);V.call(this,e),this._transformState=new rf(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&(typeof e.transform=="function"&&(this._transform=e.transform),typeof e.flush=="function"&&(this._flush=e.flush)),this.once("prefinish",function(){typeof this._flush=="function"?this._flush(function(r){hn(t,r)}):hn(t)})}X.prototype.push=function(e,t){return this._transformState.needTransform=!1,V.prototype.push.call(this,e,t)},X.prototype._transform=function(e,t,r){throw new Error("Not implemented")},X.prototype._write=function(e,t,r){var i=this._transformState;if(i.writecb=r,i.writechunk=e,i.writeencoding=t,!i.transforming){var n=this._readableState;(i.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},X.prototype._read=function(e){var t=this._transformState;t.writechunk!==null&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};function hn(e,t){if(t)return e.emit("error",t);var r=e._writableState,i=e._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}j(ht,X);function ht(e){if(!(this instanceof ht))return new ht(e);X.call(this,e)}ht.prototype._transform=function(e,t,r){r(null,e)},j(le,C),le.Readable=N,le.Writable=$,le.Duplex=V,le.Transform=X,le.PassThrough=ht,le.Stream=le;function le(){C.call(this)}le.prototype.pipe=function(e,t){var r=this;function i(l){e.writable&&e.write(l)===!1&&r.pause&&r.pause()}r.on("data",i);function n(){r.readable&&r.resume&&r.resume()}e.on("drain",n),!e._isStdio&&(!t||t.end!==!1)&&(r.on("end",o),r.on("close",s));var a=!1;function o(){a||(a=!0,e.end())}function s(){a||(a=!0,typeof e.destroy=="function"&&e.destroy())}function h(l){if(f(),C.listenerCount(this,"error")===0)throw l}r.on("error",h),e.on("error",h);function f(){r.removeListener("data",i),e.removeListener("drain",n),r.removeListener("end",o),r.removeListener("close",s),r.removeListener("error",h),e.removeListener("error",h),r.removeListener("end",f),r.removeListener("close",f),e.removeListener("close",f)}return r.on("end",f),r.on("close",f),e.on("close",f),e.emit("pipe",r),e};var un={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function af(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function he(e,t,r,i,n){if(t.subarray&&e.subarray){e.set(t.subarray(r,r+i),n);return}for(var a=0;a<i;a++)e[n+a]=t[r+a]}var Pt=Uint8Array,J=Uint16Array,Zt=Int32Array,of=4,cn=0,dn=1,sf=2;function Qe(e){for(var t=e.length;--t>=0;)e[t]=0}var ff=0,pn=1,lf=2,hf=3,uf=258,Mr=29,ut=256,ct=ut+1+Mr,et=30,Or=19,_n=2*ct+1,Oe=15,Fr=16,cf=7,Dr=256,gn=16,wn=17,vn=18,Nr=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],jt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],df=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],mn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pf=512,ue=new Array((ct+2)*2);Qe(ue);var dt=new Array(et*2);Qe(dt);var pt=new Array(pf);Qe(pt);var _t=new Array(uf-hf+1);Qe(_t);var zr=new Array(Mr);Qe(zr);var $t=new Array(et);Qe($t);function Br(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}var bn,yn,xn;function Ur(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function En(e){return e<256?pt[e]:pt[256+(e>>>7)]}function gt(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function W(e,t,r){e.bi_valid>Fr-r?(e.bi_buf|=t<<e.bi_valid&65535,gt(e,e.bi_buf),e.bi_buf=t>>Fr-e.bi_valid,e.bi_valid+=r-Fr):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function ie(e,t,r){W(e,r[t*2],r[t*2+1])}function Sn(e,t){var r=0;do r|=e&1,e>>>=1,r<<=1;while(--t>0);return r>>>1}function _f(e){e.bi_valid===16?(gt(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function gf(e,t){var r=t.dyn_tree,i=t.max_code,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,h=t.stat_desc.max_length,f,l,_,g,u,v,b=0;for(g=0;g<=Oe;g++)e.bl_count[g]=0;for(r[e.heap[e.heap_max]*2+1]=0,f=e.heap_max+1;f<_n;f++)l=e.heap[f],g=r[r[l*2+1]*2+1]+1,g>h&&(g=h,b++),r[l*2+1]=g,!(l>i)&&(e.bl_count[g]++,u=0,l>=s&&(u=o[l-s]),v=r[l*2],e.opt_len+=v*(g+u),a&&(e.static_len+=v*(n[l*2+1]+u)));if(b!==0){do{for(g=h-1;e.bl_count[g]===0;)g--;e.bl_count[g]--,e.bl_count[g+1]+=2,e.bl_count[h]--,b-=2}while(b>0);for(g=h;g!==0;g--)for(l=e.bl_count[g];l!==0;)_=e.heap[--f],!(_>i)&&(r[_*2+1]!==g&&(e.opt_len+=(g-r[_*2+1])*r[_*2],r[_*2+1]=g),l--)}}function kn(e,t,r){var i=new Array(Oe+1),n=0,a,o;for(a=1;a<=Oe;a++)i[a]=n=n+r[a-1]<<1;for(o=0;o<=t;o++){var s=e[o*2+1];s!==0&&(e[o*2]=Sn(i[s]++,s))}}function wf(){var e,t,r,i,n,a=new Array(Oe+1);for(r=0,i=0;i<Mr-1;i++)for(zr[i]=r,e=0;e<1<<Nr[i];e++)_t[r++]=i;for(_t[r-1]=i,n=0,i=0;i<16;i++)for($t[i]=n,e=0;e<1<<jt[i];e++)pt[n++]=i;for(n>>=7;i<et;i++)for($t[i]=n<<7,e=0;e<1<<jt[i]-7;e++)pt[256+n++]=i;for(t=0;t<=Oe;t++)a[t]=0;for(e=0;e<=143;)ue[e*2+1]=8,e++,a[8]++;for(;e<=255;)ue[e*2+1]=9,e++,a[9]++;for(;e<=279;)ue[e*2+1]=7,e++,a[7]++;for(;e<=287;)ue[e*2+1]=8,e++,a[8]++;for(kn(ue,ct+1,a),e=0;e<et;e++)dt[e*2+1]=5,dt[e*2]=Sn(e,5);bn=new Br(ue,Nr,ut+1,ct,Oe),yn=new Br(dt,jt,0,et,Oe),xn=new Br(new Array(0),df,0,Or,cf)}function Rn(e){var t;for(t=0;t<ct;t++)e.dyn_ltree[t*2]=0;for(t=0;t<et;t++)e.dyn_dtree[t*2]=0;for(t=0;t<Or;t++)e.bl_tree[t*2]=0;e.dyn_ltree[Dr*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function An(e){e.bi_valid>8?gt(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function vf(e,t,r,i){An(e),gt(e,r),gt(e,~r),he(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}function Tn(e,t,r,i){var n=t*2,a=r*2;return e[n]<e[a]||e[n]===e[a]&&i[t]<=i[r]}function Pr(e,t,r){for(var i=e.heap[r],n=r<<1;n<=e.heap_len&&(n<e.heap_len&&Tn(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!Tn(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i}function Cn(e,t,r){var i,n,a=0,o,s;if(e.last_lit!==0)do i=e.pending_buf[e.d_buf+a*2]<<8|e.pending_buf[e.d_buf+a*2+1],n=e.pending_buf[e.l_buf+a],a++,i===0?ie(e,n,t):(o=_t[n],ie(e,o+ut+1,t),s=Nr[o],s!==0&&(n-=zr[o],W(e,n,s)),i--,o=En(i),ie(e,o,r),s=jt[o],s!==0&&(i-=$t[o],W(e,i,s)));while(a<e.last_lit);ie(e,Dr,t)}function Zr(e,t){var r=t.dyn_tree,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,a=t.stat_desc.elems,o,s,h=-1,f;for(e.heap_len=0,e.heap_max=_n,o=0;o<a;o++)r[o*2]!==0?(e.heap[++e.heap_len]=h=o,e.depth[o]=0):r[o*2+1]=0;for(;e.heap_len<2;)f=e.heap[++e.heap_len]=h<2?++h:0,r[f*2]=1,e.depth[f]=0,e.opt_len--,n&&(e.static_len-=i[f*2+1]);for(t.max_code=h,o=e.heap_len>>1;o>=1;o--)Pr(e,r,o);f=a;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Pr(e,r,1),s=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=s,r[f*2]=r[o*2]+r[s*2],e.depth[f]=(e.depth[o]>=e.depth[s]?e.depth[o]:e.depth[s])+1,r[o*2+1]=r[s*2+1]=f,e.heap[1]=f++,Pr(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],gf(e,t),kn(r,h,e.bl_count)}function Ln(e,t,r){var i,n=-1,a,o=t[0*2+1],s=0,h=7,f=4;for(o===0&&(h=138,f=3),t[(r+1)*2+1]=65535,i=0;i<=r;i++)a=o,o=t[(i+1)*2+1],!(++s<h&&a===o)&&(s<f?e.bl_tree[a*2]+=s:a!==0?(a!==n&&e.bl_tree[a*2]++,e.bl_tree[gn*2]++):s<=10?e.bl_tree[wn*2]++:e.bl_tree[vn*2]++,s=0,n=a,o===0?(h=138,f=3):a===o?(h=6,f=3):(h=7,f=4))}function In(e,t,r){var i,n=-1,a,o=t[0*2+1],s=0,h=7,f=4;for(o===0&&(h=138,f=3),i=0;i<=r;i++)if(a=o,o=t[(i+1)*2+1],!(++s<h&&a===o)){if(s<f)do ie(e,a,e.bl_tree);while(--s!==0);else a!==0?(a!==n&&(ie(e,a,e.bl_tree),s--),ie(e,gn,e.bl_tree),W(e,s-3,2)):s<=10?(ie(e,wn,e.bl_tree),W(e,s-3,3)):(ie(e,vn,e.bl_tree),W(e,s-11,7));s=0,n=a,o===0?(h=138,f=3):a===o?(h=6,f=3):(h=7,f=4)}}function mf(e){var t;for(Ln(e,e.dyn_ltree,e.l_desc.max_code),Ln(e,e.dyn_dtree,e.d_desc.max_code),Zr(e,e.bl_desc),t=Or-1;t>=3&&e.bl_tree[mn[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t}function bf(e,t,r,i){var n;for(W(e,t-257,5),W(e,r-1,5),W(e,i-4,4),n=0;n<i;n++)W(e,e.bl_tree[mn[n]*2+1],3);In(e,e.dyn_ltree,t-1),In(e,e.dyn_dtree,r-1)}function yf(e){var t=4093624447,r;for(r=0;r<=31;r++,t>>>=1)if(t&1&&e.dyn_ltree[r*2]!==0)return cn;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return dn;for(r=32;r<ut;r++)if(e.dyn_ltree[r*2]!==0)return dn;return cn}var Mn=!1;function xf(e){Mn||(wf(),Mn=!0),e.l_desc=new Ur(e.dyn_ltree,bn),e.d_desc=new Ur(e.dyn_dtree,yn),e.bl_desc=new Ur(e.bl_tree,xn),e.bi_buf=0,e.bi_valid=0,Rn(e)}function On(e,t,r,i){W(e,(ff<<1)+(i?1:0),3),vf(e,t,r)}function Ef(e){W(e,pn<<1,3),ie(e,Dr,ue),_f(e)}function Sf(e,t,r,i){var n,a,o=0;e.level>0?(e.strm.data_type===sf&&(e.strm.data_type=yf(e)),Zr(e,e.l_desc),Zr(e,e.d_desc),o=mf(e),n=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=n&&(n=a)):n=a=r+5,r+4<=n&&t!==-1?On(e,t,r,i):e.strategy===of||a===n?(W(e,(pn<<1)+(i?1:0),3),Cn(e,ue,dt)):(W(e,(lf<<1)+(i?1:0),3),bf(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),Cn(e,e.dyn_ltree,e.dyn_dtree)),Rn(e),i&&An(e)}function ve(e,t,r){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=r&255,e.last_lit++,t===0?e.dyn_ltree[r*2]++:(e.matches++,t--,e.dyn_ltree[(_t[r]+ut+1)*2]++,e.dyn_dtree[En(t)*2]++),e.last_lit===e.lit_bufsize-1}function jr(e,t,r,i){for(var n=e&65535|0,a=e>>>16&65535|0,o=0;r!==0;){o=r>2e3?2e3:r,r-=o;do n=n+t[i++]|0,a=a+n|0;while(--o);n%=65521,a%=65521}return n|a<<16|0}function kf(){for(var e,t=[],r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var Rf=kf();function U(e,t,r,i){var n=Rf,a=i+r;e^=-1;for(var o=i;o<a;o++)e=e>>>8^n[(e^t[o])&255];return e^-1}var Fe=0,Af=1,Tf=3,me=4,Fn=5,be=0,Dn=1,ye=-2,Cf=-3,$r=-5,Lf=-1,If=1,Ht=2,Mf=3,Of=4,Ff=2,Hr=8,Df=9,Nf=29,zf=256,Wr=zf+1+Nf,Bf=30,Uf=19,Pf=2*Wr+1,Zf=15,I=3,xe=258,Q=xe+I+1,jf=32,Kr=42,Yr=69,Wt=73,Kt=91,Yt=103,De=113,wt=666,z=1,vt=2,Ne=3,tt=4,$f=3;function Ee(e,t){return e.msg=un[t],t}function Nn(e){return(e<<1)-(e>4?9:0)}function ze(e){for(var t=e.length;--t>=0;)e[t]=0}function Se(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(he(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))}function Z(e,t){Sf(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Se(e.strm)}function L(e,t){e.pending_buf[e.pending++]=t}function mt(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function Hf(e,t,r,i){var n=e.avail_in;return n>i&&(n=i),n===0?0:(e.avail_in-=n,he(t,e.input,e.next_in,n,r),e.state.wrap===1?e.adler=jr(e.adler,t,n,r):e.state.wrap===2&&(e.adler=U(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)}function zn(e,t){var r=e.max_chain_length,i=e.strstart,n,a,o=e.prev_length,s=e.nice_match,h=e.strstart>e.w_size-Q?e.strstart-(e.w_size-Q):0,f=e.window,l=e.w_mask,_=e.prev,g=e.strstart+xe,u=f[i+o-1],v=f[i+o];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do if(n=t,!(f[n+o]!==v||f[n+o-1]!==u||f[n]!==f[i]||f[++n]!==f[i+1])){i+=2,n++;do;while(f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&f[++i]===f[++n]&&i<g);if(a=xe-(g-i),i=g-xe,a>o){if(e.match_start=t,o=a,a>=s)break;u=f[i+o-1],v=f[i+o]}}while((t=_[t&l])>h&&--r!==0);return o<=e.lookahead?o:e.lookahead}function bt(e){var t=e.w_size,r,i,n,a,o;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Q)){he(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,r=i;do n=e.head[--r],e.head[r]=n>=t?n-t:0;while(--i);i=t,r=i;do n=e.prev[--r],e.prev[r]=n>=t?n-t:0;while(--i);a+=t}if(e.strm.avail_in===0)break;if(i=Hf(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=i,e.lookahead+e.insert>=I)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+I-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<I)););}while(e.lookahead<Q&&e.strm.avail_in!==0)}function Wf(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(bt(e),e.lookahead===0&&t===Fe)return z;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+r;if((e.strstart===0||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,Z(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-Q&&(Z(e,!1),e.strm.avail_out===0))return z}return e.insert=0,t===me?(Z(e,!0),e.strm.avail_out===0?Ne:tt):(e.strstart>e.block_start&&(Z(e,!1),e.strm.avail_out===0),z)}function qr(e,t){for(var r,i;;){if(e.lookahead<Q){if(bt(e),e.lookahead<Q&&t===Fe)return z;if(e.lookahead===0)break}if(r=0,e.lookahead>=I&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Q&&(e.match_length=zn(e,r)),e.match_length>=I)if(i=ve(e,e.strstart-e.match_start,e.match_length-I),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=I){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=ve(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Z(e,!1),e.strm.avail_out===0))return z}return e.insert=e.strstart<I-1?e.strstart:I-1,t===me?(Z(e,!0),e.strm.avail_out===0?Ne:tt):e.last_lit&&(Z(e,!1),e.strm.avail_out===0)?z:vt}function rt(e,t){for(var r,i,n;;){if(e.lookahead<Q){if(bt(e),e.lookahead<Q&&t===Fe)return z;if(e.lookahead===0)break}if(r=0,e.lookahead>=I&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=I-1,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Q&&(e.match_length=zn(e,r),e.match_length<=5&&(e.strategy===If||e.match_length===I&&e.strstart-e.match_start>4096)&&(e.match_length=I-1)),e.prev_length>=I&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-I,i=ve(e,e.strstart-1-e.prev_match,e.prev_length-I),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+I-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=I-1,e.strstart++,i&&(Z(e,!1),e.strm.avail_out===0))return z}else if(e.match_available){if(i=ve(e,0,e.window[e.strstart-1]),i&&Z(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return z}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=ve(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<I-1?e.strstart:I-1,t===me?(Z(e,!0),e.strm.avail_out===0?Ne:tt):e.last_lit&&(Z(e,!1),e.strm.avail_out===0)?z:vt}function Kf(e,t){for(var r,i,n,a,o=e.window;;){if(e.lookahead<=xe){if(bt(e),e.lookahead<=xe&&t===Fe)return z;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=I&&e.strstart>0&&(n=e.strstart-1,i=o[n],i===o[++n]&&i===o[++n]&&i===o[++n])){a=e.strstart+xe;do;while(i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&i===o[++n]&&n<a);e.match_length=xe-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=I?(r=ve(e,1,e.match_length-I),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=ve(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Z(e,!1),e.strm.avail_out===0))return z}return e.insert=0,t===me?(Z(e,!0),e.strm.avail_out===0?Ne:tt):e.last_lit&&(Z(e,!1),e.strm.avail_out===0)?z:vt}function Yf(e,t){for(var r;;){if(e.lookahead===0&&(bt(e),e.lookahead===0)){if(t===Fe)return z;break}if(e.match_length=0,r=ve(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Z(e,!1),e.strm.avail_out===0))return z}return e.insert=0,t===me?(Z(e,!0),e.strm.avail_out===0?Ne:tt):e.last_lit&&(Z(e,!1),e.strm.avail_out===0)?z:vt}function ne(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}var it;it=[new ne(0,0,0,0,Wf),new ne(4,4,8,4,qr),new ne(4,5,16,8,qr),new ne(4,6,32,32,qr),new ne(4,4,16,16,rt),new ne(8,16,32,32,rt),new ne(8,16,128,128,rt),new ne(8,32,128,256,rt),new ne(32,128,258,1024,rt),new ne(32,258,258,4096,rt)];function qf(e){e.window_size=2*e.w_size,ze(e.head),e.max_lazy_match=it[e.level].max_lazy,e.good_match=it[e.level].good_length,e.nice_match=it[e.level].nice_length,e.max_chain_length=it[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=I-1,e.match_available=0,e.ins_h=0}function Gf(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Hr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new J(Pf*2),this.dyn_dtree=new J((2*Bf+1)*2),this.bl_tree=new J((2*Uf+1)*2),ze(this.dyn_ltree),ze(this.dyn_dtree),ze(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new J(Zf+1),this.heap=new J(2*Wr+1),ze(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new J(2*Wr+1),ze(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Vf(e){var t;return!e||!e.state?Ee(e,ye):(e.total_in=e.total_out=0,e.data_type=Ff,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?Kr:De,e.adler=t.wrap===2?0:1,t.last_flush=Fe,xf(t),be)}function Bn(e){var t=Vf(e);return t===be&&qf(e.state),t}function Xf(e,t,r,i,n,a){if(!e)return ye;var o=1;if(t===Lf&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),n<1||n>Df||r!==Hr||i<8||i>15||t<0||t>9||a<0||a>Of)return Ee(e,ye);i===8&&(i=9);var s=new Gf;return e.state=s,s.strm=e,s.wrap=o,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+I-1)/I),s.window=new Pt(s.w_size*2),s.head=new J(s.hash_size),s.prev=new J(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Pt(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=r,Bn(e)}function Jf(e,t){var r,i,n,a;if(!e||!e.state||t>Fn||t<0)return e?Ee(e,ye):ye;if(i=e.state,!e.output||!e.input&&e.avail_in!==0||i.status===wt&&t!==me)return Ee(e,e.avail_out===0?$r:ye);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===Kr)if(i.wrap===2)e.adler=0,L(i,31),L(i,139),L(i,8),i.gzhead?(L(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),L(i,i.gzhead.time&255),L(i,i.gzhead.time>>8&255),L(i,i.gzhead.time>>16&255),L(i,i.gzhead.time>>24&255),L(i,i.level===9?2:i.strategy>=Ht||i.level<2?4:0),L(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(L(i,i.gzhead.extra.length&255),L(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=U(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=Yr):(L(i,0),L(i,0),L(i,0),L(i,0),L(i,0),L(i,i.level===9?2:i.strategy>=Ht||i.level<2?4:0),L(i,$f),i.status=De);else{var o=Hr+(i.w_bits-8<<4)<<8,s=-1;i.strategy>=Ht||i.level<2?s=0:i.level<6?s=1:i.level===6?s=2:s=3,o|=s<<6,i.strstart!==0&&(o|=jf),o+=31-o%31,i.status=De,mt(i,o),i.strstart!==0&&(mt(i,e.adler>>>16),mt(i,e.adler&65535)),e.adler=1}if(i.status===Yr)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=U(e.adler,i.pending_buf,i.pending-n,n)),Se(e),n=i.pending,i.pending===i.pending_buf_size));)L(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(e.adler=U(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=Wt)}else i.status=Wt;if(i.status===Wt)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=U(e.adler,i.pending_buf,i.pending-n,n)),Se(e),n=i.pending,i.pending===i.pending_buf_size)){a=1;break}i.gzindex<i.gzhead.name.length?a=i.gzhead.name.charCodeAt(i.gzindex++)&255:a=0,L(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>n&&(e.adler=U(e.adler,i.pending_buf,i.pending-n,n)),a===0&&(i.gzindex=0,i.status=Kt)}else i.status=Kt;if(i.status===Kt)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(e.adler=U(e.adler,i.pending_buf,i.pending-n,n)),Se(e),n=i.pending,i.pending===i.pending_buf_size)){a=1;break}i.gzindex<i.gzhead.comment.length?a=i.gzhead.comment.charCodeAt(i.gzindex++)&255:a=0,L(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>n&&(e.adler=U(e.adler,i.pending_buf,i.pending-n,n)),a===0&&(i.status=Yt)}else i.status=Yt;if(i.status===Yt&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Se(e),i.pending+2<=i.pending_buf_size&&(L(i,e.adler&255),L(i,e.adler>>8&255),e.adler=0,i.status=De)):i.status=De),i.pending!==0){if(Se(e),e.avail_out===0)return i.last_flush=-1,be}else if(e.avail_in===0&&Nn(t)<=Nn(r)&&t!==me)return Ee(e,$r);if(i.status===wt&&e.avail_in!==0)return Ee(e,$r);if(e.avail_in!==0||i.lookahead!==0||t!==Fe&&i.status!==wt){var h=i.strategy===Ht?Yf(i,t):i.strategy===Mf?Kf(i,t):it[i.level].func(i,t);if((h===Ne||h===tt)&&(i.status=wt),h===z||h===Ne)return e.avail_out===0&&(i.last_flush=-1),be;if(h===vt&&(t===Af?Ef(i):t!==Fn&&(On(i,0,0,!1),t===Tf&&(ze(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Se(e),e.avail_out===0))return i.last_flush=-1,be}return t!==me?be:i.wrap<=0?Dn:(i.wrap===2?(L(i,e.adler&255),L(i,e.adler>>8&255),L(i,e.adler>>16&255),L(i,e.adler>>24&255),L(i,e.total_in&255),L(i,e.total_in>>8&255),L(i,e.total_in>>16&255),L(i,e.total_in>>24&255)):(mt(i,e.adler>>>16),mt(i,e.adler&65535)),Se(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?be:Dn)}function Qf(e){var t;return!e||!e.state?ye:(t=e.state.status,t!==Kr&&t!==Yr&&t!==Wt&&t!==Kt&&t!==Yt&&t!==De&&t!==wt?Ee(e,ye):(e.state=null,t===De?Ee(e,Cf):be))}var qt=30,el=12;function tl(e,t){var r,i,n,a,o,s,h,f,l,_,g,u,v,b,y,E,d,w,p,S,T,m,A,R,k;r=e.state,i=e.next_in,R=e.input,n=i+(e.avail_in-5),a=e.next_out,k=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),h=r.dmax,f=r.wsize,l=r.whave,_=r.wnext,g=r.window,u=r.hold,v=r.bits,b=r.lencode,y=r.distcode,E=(1<<r.lenbits)-1,d=(1<<r.distbits)-1;e:do{v<15&&(u+=R[i++]<<v,v+=8,u+=R[i++]<<v,v+=8),w=b[u&E];t:for(;;){if(p=w>>>24,u>>>=p,v-=p,p=w>>>16&255,p===0)k[a++]=w&65535;else if(p&16){S=w&65535,p&=15,p&&(v<p&&(u+=R[i++]<<v,v+=8),S+=u&(1<<p)-1,u>>>=p,v-=p),v<15&&(u+=R[i++]<<v,v+=8,u+=R[i++]<<v,v+=8),w=y[u&d];r:for(;;){if(p=w>>>24,u>>>=p,v-=p,p=w>>>16&255,p&16){if(T=w&65535,p&=15,v<p&&(u+=R[i++]<<v,v+=8,v<p&&(u+=R[i++]<<v,v+=8)),T+=u&(1<<p)-1,T>h){e.msg="invalid distance too far back",r.mode=qt;break e}if(u>>>=p,v-=p,p=a-o,T>p){if(p=T-p,p>l&&r.sane){e.msg="invalid distance too far back",r.mode=qt;break e}if(m=0,A=g,_===0){if(m+=f-p,p<S){S-=p;do k[a++]=g[m++];while(--p);m=a-T,A=k}}else if(_<p){if(m+=f+_-p,p-=_,p<S){S-=p;do k[a++]=g[m++];while(--p);if(m=0,_<S){p=_,S-=p;do k[a++]=g[m++];while(--p);m=a-T,A=k}}}else if(m+=_-p,p<S){S-=p;do k[a++]=g[m++];while(--p);m=a-T,A=k}for(;S>2;)k[a++]=A[m++],k[a++]=A[m++],k[a++]=A[m++],S-=3;S&&(k[a++]=A[m++],S>1&&(k[a++]=A[m++]))}else{m=a-T;do k[a++]=k[m++],k[a++]=k[m++],k[a++]=k[m++],S-=3;while(S>2);S&&(k[a++]=k[m++],S>1&&(k[a++]=k[m++]))}}else if(p&64){e.msg="invalid distance code",r.mode=qt;break e}else{w=y[(w&65535)+(u&(1<<p)-1)];continue r}break}}else if(p&64)if(p&32){r.mode=el;break e}else{e.msg="invalid literal/length code",r.mode=qt;break e}else{w=b[(w&65535)+(u&(1<<p)-1)];continue t}break}}while(i<n&&a<s);S=v>>3,i-=S,v-=S<<3,u&=(1<<v)-1,e.next_in=i,e.next_out=a,e.avail_in=i<n?5+(n-i):5-(i-n),e.avail_out=a<s?257+(s-a):257-(a-s),r.hold=u,r.bits=v}var nt=15,Un=852,Pn=592,Zn=0,Gr=1,jn=2,rl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],il=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],nl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],al=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function yt(e,t,r,i,n,a,o,s){var h=s.bits,f=0,l=0,_=0,g=0,u=0,v=0,b=0,y=0,E=0,d=0,w,p,S,T,m,A=null,R=0,k,O=new J(nt+1),K=new J(nt+1),Ye=null,Tt=0,Ct,qe,Re;for(f=0;f<=nt;f++)O[f]=0;for(l=0;l<i;l++)O[t[r+l]]++;for(u=h,g=nt;g>=1&&O[g]===0;g--);if(u>g&&(u=g),g===0)return n[a++]=1<<24|64<<16|0,n[a++]=1<<24|64<<16|0,s.bits=1,0;for(_=1;_<g&&O[_]===0;_++);for(u<_&&(u=_),y=1,f=1;f<=nt;f++)if(y<<=1,y-=O[f],y<0)return-1;if(y>0&&(e===Zn||g!==1))return-1;for(K[1]=0,f=1;f<nt;f++)K[f+1]=K[f]+O[f];for(l=0;l<i;l++)t[r+l]!==0&&(o[K[t[r+l]]++]=l);if(e===Zn?(A=Ye=o,k=19):e===Gr?(A=rl,R-=257,Ye=il,Tt-=257,k=256):(A=nl,Ye=al,k=-1),d=0,l=0,f=_,m=a,v=u,b=0,S=-1,E=1<<u,T=E-1,e===Gr&&E>Un||e===jn&&E>Pn)return 1;for(;;){Ct=f-b,o[l]<k?(qe=0,Re=o[l]):o[l]>k?(qe=Ye[Tt+o[l]],Re=A[R+o[l]]):(qe=96,Re=0),w=1<<f-b,p=1<<v,_=p;do p-=w,n[m+(d>>b)+p]=Ct<<24|qe<<16|Re|0;while(p!==0);for(w=1<<f-1;d&w;)w>>=1;if(w!==0?(d&=w-1,d+=w):d=0,l++,--O[f]===0){if(f===g)break;f=t[r+o[l]]}if(f>u&&(d&T)!==S){for(b===0&&(b=u),m+=_,v=f-b,y=1<<v;v+b<g&&(y-=O[v+b],!(y<=0));)v++,y<<=1;if(E+=1<<v,e===Gr&&E>Un||e===jn&&E>Pn)return 1;S=d&T,n[S]=u<<24|v<<16|m-a|0}}return d!==0&&(n[m+d]=f-b<<24|64<<16|0),s.bits=u,0}var ol=0,$n=1,Hn=2,Wn=4,sl=5,Gt=6,xt=0,fl=1,ll=2,ke=-2,hl=-3,ul=-4,cl=-5,Kn=8,Yn=1,qn=2,Gn=3,Vn=4,Xn=5,Jn=6,Qn=7,ea=8,ta=9,ra=10,ia=11,ce=12,Vr=13,na=14,Xr=15,aa=16,oa=17,sa=18,fa=19,Vt=20,Xt=21,la=22,ha=23,ua=24,ca=25,da=26,Jr=27,pa=28,_a=29,F=30,dl=31,pl=32,_l=852,gl=592;function ga(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function wl(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new J(320),this.work=new J(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function vl(e){var t;return!e||!e.state?ke:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=Yn,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Zt(_l),t.distcode=t.distdyn=new Zt(gl),t.sane=1,t.back=-1,xt)}function wa(e){var t;return!e||!e.state?ke:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,vl(e))}function ml(e,t){var r,i;return!e||!e.state||(i=e.state,t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15))?ke:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,wa(e))}function bl(e,t){var r,i;return e?(i=new wl,e.state=i,i.window=null,r=ml(e,t),r!==xt&&(e.state=null),r):ke}var va=!0,Qr,ei;function yl(e){if(va){var t;for(Qr=new Zt(512),ei=new Zt(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(yt($n,e.lens,0,288,Qr,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;yt(Hn,e.lens,0,32,ei,0,e.work,{bits:5}),va=!1}e.lencode=Qr,e.lenbits=9,e.distcode=ei,e.distbits=5}function xl(e,t,r,i){var n,a=e.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Pt(a.wsize)),i>=a.wsize?(he(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(n=a.wsize-a.wnext,n>i&&(n=i),he(a.window,t,r-i,n,a.wnext),i-=n,i?(he(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}function El(e,t){var r,i,n,a,o,s,h,f,l,_,g,u,v,b,y=0,E,d,w,p,S,T,m,A,R=new Pt(4),k,O,K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return ke;r=e.state,r.mode===ce&&(r.mode=Vr),o=e.next_out,n=e.output,h=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,f=r.hold,l=r.bits,_=s,g=h,A=xt;e:for(;;)switch(r.mode){case Yn:if(r.wrap===0){r.mode=Vr;break}for(;l<16;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if(r.wrap&2&&f===35615){r.check=0,R[0]=f&255,R[1]=f>>>8&255,r.check=U(r.check,R,2,0),f=0,l=0,r.mode=qn;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((f&255)<<8)+(f>>8))%31){e.msg="incorrect header check",r.mode=F;break}if((f&15)!==Kn){e.msg="unknown compression method",r.mode=F;break}if(f>>>=4,l-=4,m=(f&15)+8,r.wbits===0)r.wbits=m;else if(m>r.wbits){e.msg="invalid window size",r.mode=F;break}r.dmax=1<<m,e.adler=r.check=1,r.mode=f&512?ra:ce,f=0,l=0;break;case qn:for(;l<16;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if(r.flags=f,(r.flags&255)!==Kn){e.msg="unknown compression method",r.mode=F;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=F;break}r.head&&(r.head.text=f>>8&1),r.flags&512&&(R[0]=f&255,R[1]=f>>>8&255,r.check=U(r.check,R,2,0)),f=0,l=0,r.mode=Gn;case Gn:for(;l<32;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}r.head&&(r.head.time=f),r.flags&512&&(R[0]=f&255,R[1]=f>>>8&255,R[2]=f>>>16&255,R[3]=f>>>24&255,r.check=U(r.check,R,4,0)),f=0,l=0,r.mode=Vn;case Vn:for(;l<16;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}r.head&&(r.head.xflags=f&255,r.head.os=f>>8),r.flags&512&&(R[0]=f&255,R[1]=f>>>8&255,r.check=U(r.check,R,2,0)),f=0,l=0,r.mode=Xn;case Xn:if(r.flags&1024){for(;l<16;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}r.length=f,r.head&&(r.head.extra_len=f),r.flags&512&&(R[0]=f&255,R[1]=f>>>8&255,r.check=U(r.check,R,2,0)),f=0,l=0}else r.head&&(r.head.extra=null);r.mode=Jn;case Jn:if(r.flags&1024&&(u=r.length,u>s&&(u=s),u&&(r.head&&(m=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),he(r.head.extra,i,a,u,m)),r.flags&512&&(r.check=U(r.check,i,u,a)),s-=u,a+=u,r.length-=u),r.length))break e;r.length=0,r.mode=Qn;case Qn:if(r.flags&2048){if(s===0)break e;u=0;do m=i[a+u++],r.head&&m&&r.length<65536&&(r.head.name+=String.fromCharCode(m));while(m&&u<s);if(r.flags&512&&(r.check=U(r.check,i,u,a)),s-=u,a+=u,m)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=ea;case ea:if(r.flags&4096){if(s===0)break e;u=0;do m=i[a+u++],r.head&&m&&r.length<65536&&(r.head.comment+=String.fromCharCode(m));while(m&&u<s);if(r.flags&512&&(r.check=U(r.check,i,u,a)),s-=u,a+=u,m)break e}else r.head&&(r.head.comment=null);r.mode=ta;case ta:if(r.flags&512){for(;l<16;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if(f!==(r.check&65535)){e.msg="header crc mismatch",r.mode=F;break}f=0,l=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=ce;break;case ra:for(;l<32;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}e.adler=r.check=ga(f),f=0,l=0,r.mode=ia;case ia:if(r.havedict===0)return e.next_out=o,e.avail_out=h,e.next_in=a,e.avail_in=s,r.hold=f,r.bits=l,ll;e.adler=r.check=1,r.mode=ce;case ce:if(t===sl||t===Gt)break e;case Vr:if(r.last){f>>>=l&7,l-=l&7,r.mode=Jr;break}for(;l<3;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}switch(r.last=f&1,f>>>=1,l-=1,f&3){case 0:r.mode=na;break;case 1:if(yl(r),r.mode=Vt,t===Gt){f>>>=2,l-=2;break e}break;case 2:r.mode=oa;break;case 3:e.msg="invalid block type",r.mode=F}f>>>=2,l-=2;break;case na:for(f>>>=l&7,l-=l&7;l<32;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if((f&65535)!==(f>>>16^65535)){e.msg="invalid stored block lengths",r.mode=F;break}if(r.length=f&65535,f=0,l=0,r.mode=Xr,t===Gt)break e;case Xr:r.mode=aa;case aa:if(u=r.length,u){if(u>s&&(u=s),u>h&&(u=h),u===0)break e;he(n,i,a,u,o),s-=u,a+=u,h-=u,o+=u,r.length-=u;break}r.mode=ce;break;case oa:for(;l<14;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if(r.nlen=(f&31)+257,f>>>=5,l-=5,r.ndist=(f&31)+1,f>>>=5,l-=5,r.ncode=(f&15)+4,f>>>=4,l-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=F;break}r.have=0,r.mode=sa;case sa:for(;r.have<r.ncode;){for(;l<3;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}r.lens[K[r.have++]]=f&7,f>>>=3,l-=3}for(;r.have<19;)r.lens[K[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,k={bits:r.lenbits},A=yt(ol,r.lens,0,19,r.lencode,0,r.work,k),r.lenbits=k.bits,A){e.msg="invalid code lengths set",r.mode=F;break}r.have=0,r.mode=fa;case fa:for(;r.have<r.nlen+r.ndist;){for(;y=r.lencode[f&(1<<r.lenbits)-1],E=y>>>24,d=y>>>16&255,w=y&65535,!(E<=l);){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if(w<16)f>>>=E,l-=E,r.lens[r.have++]=w;else{if(w===16){for(O=E+2;l<O;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if(f>>>=E,l-=E,r.have===0){e.msg="invalid bit length repeat",r.mode=F;break}m=r.lens[r.have-1],u=3+(f&3),f>>>=2,l-=2}else if(w===17){for(O=E+3;l<O;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}f>>>=E,l-=E,m=0,u=3+(f&7),f>>>=3,l-=3}else{for(O=E+7;l<O;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}f>>>=E,l-=E,m=0,u=11+(f&127),f>>>=7,l-=7}if(r.have+u>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=F;break}for(;u--;)r.lens[r.have++]=m}}if(r.mode===F)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=F;break}if(r.lenbits=9,k={bits:r.lenbits},A=yt($n,r.lens,0,r.nlen,r.lencode,0,r.work,k),r.lenbits=k.bits,A){e.msg="invalid literal/lengths set",r.mode=F;break}if(r.distbits=6,r.distcode=r.distdyn,k={bits:r.distbits},A=yt(Hn,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,k),r.distbits=k.bits,A){e.msg="invalid distances set",r.mode=F;break}if(r.mode=Vt,t===Gt)break e;case Vt:r.mode=Xt;case Xt:if(s>=6&&h>=258){e.next_out=o,e.avail_out=h,e.next_in=a,e.avail_in=s,r.hold=f,r.bits=l,tl(e,g),o=e.next_out,n=e.output,h=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,f=r.hold,l=r.bits,r.mode===ce&&(r.back=-1);break}for(r.back=0;y=r.lencode[f&(1<<r.lenbits)-1],E=y>>>24,d=y>>>16&255,w=y&65535,!(E<=l);){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if(d&&!(d&240)){for(p=E,S=d,T=w;y=r.lencode[T+((f&(1<<p+S)-1)>>p)],E=y>>>24,d=y>>>16&255,w=y&65535,!(p+E<=l);){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}f>>>=p,l-=p,r.back+=p}if(f>>>=E,l-=E,r.back+=E,r.length=w,d===0){r.mode=da;break}if(d&32){r.back=-1,r.mode=ce;break}if(d&64){e.msg="invalid literal/length code",r.mode=F;break}r.extra=d&15,r.mode=la;case la:if(r.extra){for(O=r.extra;l<O;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}r.length+=f&(1<<r.extra)-1,f>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=ha;case ha:for(;y=r.distcode[f&(1<<r.distbits)-1],E=y>>>24,d=y>>>16&255,w=y&65535,!(E<=l);){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if(!(d&240)){for(p=E,S=d,T=w;y=r.distcode[T+((f&(1<<p+S)-1)>>p)],E=y>>>24,d=y>>>16&255,w=y&65535,!(p+E<=l);){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}f>>>=p,l-=p,r.back+=p}if(f>>>=E,l-=E,r.back+=E,d&64){e.msg="invalid distance code",r.mode=F;break}r.offset=w,r.extra=d&15,r.mode=ua;case ua:if(r.extra){for(O=r.extra;l<O;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}r.offset+=f&(1<<r.extra)-1,f>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=F;break}r.mode=ca;case ca:if(h===0)break e;if(u=g-h,r.offset>u){if(u=r.offset-u,u>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=F;break}u>r.wnext?(u-=r.wnext,v=r.wsize-u):v=r.wnext-u,u>r.length&&(u=r.length),b=r.window}else b=n,v=o-r.offset,u=r.length;u>h&&(u=h),h-=u,r.length-=u;do n[o++]=b[v++];while(--u);r.length===0&&(r.mode=Xt);break;case da:if(h===0)break e;n[o++]=r.length,h--,r.mode=Xt;break;case Jr:if(r.wrap){for(;l<32;){if(s===0)break e;s--,f|=i[a++]<<l,l+=8}if(g-=h,e.total_out+=g,r.total+=g,g&&(e.adler=r.check=r.flags?U(r.check,n,g,o-g):jr(r.check,n,g,o-g)),g=h,(r.flags?f:ga(f))!==r.check){e.msg="incorrect data check",r.mode=F;break}f=0,l=0}r.mode=pa;case pa:if(r.wrap&&r.flags){for(;l<32;){if(s===0)break e;s--,f+=i[a++]<<l,l+=8}if(f!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=F;break}f=0,l=0}r.mode=_a;case _a:A=fl;break e;case F:A=hl;break e;case dl:return ul;case pl:default:return ke}return e.next_out=o,e.avail_out=h,e.next_in=a,e.avail_in=s,r.hold=f,r.bits=l,(r.wsize||g!==e.avail_out&&r.mode<F&&(r.mode<Jr||t!==Wn))&&xl(e,e.output,e.next_out,g-e.avail_out),_-=e.avail_in,g-=e.avail_out,e.total_in+=_,e.total_out+=g,r.total+=g,r.wrap&&g&&(e.adler=r.check=r.flags?U(r.check,n,g,e.next_out-g):jr(r.check,n,g,e.next_out-g)),e.data_type=r.bits+(r.last?64:0)+(r.mode===ce?128:0)+(r.mode===Vt||r.mode===Xr?256:0),(_===0&&g===0||t===Wn)&&A===xt&&(A=cl),A}function Sl(e){if(!e||!e.state)return ke;var t=e.state;return t.window&&(t.window=null),e.state=null,xt}var ti=0,at=1,Jt=2,Et=3,Qt=4,ot=5,St=6,kt=7,ma=0,ba=1,ya=2,xa=3,ri=4,Ea=5,kl=6,er=0,Sa=1,ka=2,Rl=-1,Al=-2,Tl=-3,Ra=-5,Cl=0,Ll=1,Il=9,Ml=-1,Ol=1,Fl=2,Dl=3,Nl=4,zl=0,Bl=0,Ul=1,Pl=2,Aa=8;function ee(e){if(e<at||e>kt)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}ee.prototype.init=function(e,t,r,i,n){this.windowBits=e,this.level=t,this.memLevel=r,this.strategy=i,(this.mode===Et||this.mode===Qt)&&(this.windowBits+=16),this.mode===kt&&(this.windowBits+=32),(this.mode===ot||this.mode===St)&&(this.windowBits=-this.windowBits),this.strm=new af;var a;switch(this.mode){case at:case Et:case ot:a=Xf(this.strm,this.level,Aa,this.windowBits,this.memLevel,this.strategy);break;case Jt:case Qt:case St:case kt:a=bl(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}if(a!==er){this._error(a);return}this.write_in_progress=!1,this.init_done=!0},ee.prototype.params=function(){throw new Error("deflateParams Not supported")},ee.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===ti)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},ee.prototype.write=function(e,t,r,i,n,a,o){this._writeCheck(),this.write_in_progress=!0;var s=this;return fe.nextTick(function(){s.write_in_progress=!1;var h=s._write(e,t,r,i,n,a,o);s.callback(h[0],h[1]),s.pending_close&&s.close()}),this};function Zl(e,t){for(var r=0;r<e.length;r++)this[t+r]=e[r]}ee.prototype.writeSync=function(e,t,r,i,n,a,o){return this._writeCheck(),this._write(e,t,r,i,n,a,o)},ee.prototype._write=function(e,t,r,i,n,a,o){if(this.write_in_progress=!0,e!==ma&&e!==ba&&e!==ya&&e!==xa&&e!==ri&&e!==Ea)throw new Error("Invalid flush value");t==null&&(t=new c(0),i=0,r=0),n._set?n.set=n._set:n.set=Zl;var s=this.strm;s.avail_in=i,s.input=t,s.next_in=r,s.avail_out=o,s.output=n,s.next_out=a;var h;switch(this.mode){case at:case Et:case ot:h=Jf(s,e);break;case kt:case Jt:case Qt:case St:h=El(s,e);break;default:throw new Error("Unknown mode "+this.mode)}return this._checkError(h,s,e)||this._error(h),this.write_in_progress=!1,[s.avail_in,s.avail_out]},ee.prototype._checkError=function(e,t,r){switch(e){case er:case Ra:if(t.avail_out!==0&&r===ri)return!1;break;case Sa:break;case ka:return!1;default:return!1}return!0},ee.prototype.close=function(){if(this.write_in_progress){this.pending_close=!0;return}this.pending_close=!1,this.mode===at||this.mode===Et||this.mode===ot?Qf(this.strm):Sl(this.strm),this.mode=ti};var tr;ee.prototype.reset=function(){switch(this.mode){case at:case ot:tr=Bn(this.strm);break;case Jt:case St:tr=wa(this.strm);break}tr!==er&&this._error(tr)},ee.prototype._error=function(e){this.onerror(un[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()};var Ta=Object.freeze({__proto__:null,DEFLATE:at,DEFLATERAW:ot,GUNZIP:Qt,GZIP:Et,INFLATE:Jt,INFLATERAW:St,NONE:ti,UNZIP:kt,Z_BEST_COMPRESSION:Il,Z_BEST_SPEED:Ll,Z_BINARY:Bl,Z_BLOCK:Ea,Z_BUF_ERROR:Ra,Z_DATA_ERROR:Tl,Z_DEFAULT_COMPRESSION:Ml,Z_DEFAULT_STRATEGY:zl,Z_DEFLATED:Aa,Z_ERRNO:Rl,Z_FILTERED:Ol,Z_FINISH:ri,Z_FIXED:Nl,Z_FULL_FLUSH:xa,Z_HUFFMAN_ONLY:Fl,Z_NEED_DICT:ka,Z_NO_COMPRESSION:Cl,Z_NO_FLUSH:ma,Z_OK:er,Z_PARTIAL_FLUSH:ba,Z_RLE:Dl,Z_STREAM_END:Sa,Z_STREAM_ERROR:Al,Z_SYNC_FLUSH:ya,Z_TEXT:Ul,Z_TREES:kl,Z_UNKNOWN:Pl,Zlib:ee});function jl(e,t){if(!e)throw new Error(t)}var x={};Object.keys(Ta).forEach(function(e){x[e]=Ta[e]}),x.Z_MIN_WINDOWBITS=8,x.Z_MAX_WINDOWBITS=15,x.Z_DEFAULT_WINDOWBITS=15,x.Z_MIN_CHUNK=64,x.Z_MAX_CHUNK=1/0,x.Z_DEFAULT_CHUNK=16*1024,x.Z_MIN_MEMLEVEL=1,x.Z_MAX_MEMLEVEL=9,x.Z_DEFAULT_MEMLEVEL=8,x.Z_MIN_LEVEL=-1,x.Z_MAX_LEVEL=9,x.Z_DEFAULT_LEVEL=x.Z_DEFAULT_COMPRESSION;var Rt={Z_OK:x.Z_OK,Z_STREAM_END:x.Z_STREAM_END,Z_NEED_DICT:x.Z_NEED_DICT,Z_ERRNO:x.Z_ERRNO,Z_STREAM_ERROR:x.Z_STREAM_ERROR,Z_DATA_ERROR:x.Z_DATA_ERROR,Z_MEM_ERROR:x.Z_MEM_ERROR,Z_BUF_ERROR:x.Z_BUF_ERROR,Z_VERSION_ERROR:x.Z_VERSION_ERROR};Object.keys(Rt).forEach(function(e){Rt[Rt[e]]=e});function $l(e){return new Pe(e)}function Hl(e){return new Ze(e)}function Wl(e){return new He(e)}function Kl(e){return new We(e)}function Yl(e){return new je(e)}function ql(e){return new $e(e)}function Gl(e){return new Ke(e)}function Vl(e,t,r){return typeof t=="function"&&(r=t,t={}),Be(new Pe(t),e,r)}function Xl(e,t){return Ue(new Pe(t),e)}function Jl(e,t,r){return typeof t=="function"&&(r=t,t={}),Be(new je(t),e,r)}function Ql(e,t){return Ue(new je(t),e)}function eh(e,t,r){return typeof t=="function"&&(r=t,t={}),Be(new He(t),e,r)}function th(e,t){return Ue(new He(t),e)}function rh(e,t,r){return typeof t=="function"&&(r=t,t={}),Be(new Ke(t),e,r)}function ih(e,t){return Ue(new Ke(t),e)}function nh(e,t,r){return typeof t=="function"&&(r=t,t={}),Be(new Ze(t),e,r)}function ah(e,t){return Ue(new Ze(t),e)}function oh(e,t,r){return typeof t=="function"&&(r=t,t={}),Be(new $e(t),e,r)}function sh(e,t){return Ue(new $e(t),e)}function fh(e,t,r){return typeof t=="function"&&(r=t,t={}),Be(new We(t),e,r)}function lh(e,t){return Ue(new We(t),e)}function Be(e,t,r){var i=[],n=0;e.on("error",o),e.on("end",s),e.end(t),a();function a(){for(var h;(h=e.read())!==null;)i.push(h),n+=h.length;e.once("readable",a)}function o(h){e.removeListener("end",s),e.removeListener("readable",a),r(h)}function s(){var h=c.concat(i,n);i=[],r(null,h),e.close()}}function Ue(e,t){if(typeof t=="string"&&(t=new c(t)),!c.isBuffer(t))throw new TypeError("Not a string or buffer");var r=x.Z_FINISH;return e._processChunk(t,r)}function Pe(e){if(!(this instanceof Pe))return new Pe(e);D.call(this,e,x.DEFLATE)}function Ze(e){if(!(this instanceof Ze))return new Ze(e);D.call(this,e,x.INFLATE)}function je(e){if(!(this instanceof je))return new je(e);D.call(this,e,x.GZIP)}function $e(e){if(!(this instanceof $e))return new $e(e);D.call(this,e,x.GUNZIP)}function He(e){if(!(this instanceof He))return new He(e);D.call(this,e,x.DEFLATERAW)}function We(e){if(!(this instanceof We))return new We(e);D.call(this,e,x.INFLATERAW)}function Ke(e){if(!(this instanceof Ke))return new Ke(e);D.call(this,e,x.UNZIP)}function D(e,t){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||x.Z_DEFAULT_CHUNK,X.call(this,e),e.flush&&e.flush!==x.Z_NO_FLUSH&&e.flush!==x.Z_PARTIAL_FLUSH&&e.flush!==x.Z_SYNC_FLUSH&&e.flush!==x.Z_FULL_FLUSH&&e.flush!==x.Z_FINISH&&e.flush!==x.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||x.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<x.Z_MIN_CHUNK||e.chunkSize>x.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<x.Z_MIN_WINDOWBITS||e.windowBits>x.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<x.Z_MIN_LEVEL||e.level>x.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<x.Z_MIN_MEMLEVEL||e.memLevel>x.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=x.Z_FILTERED&&e.strategy!=x.Z_HUFFMAN_ONLY&&e.strategy!=x.Z_RLE&&e.strategy!=x.Z_FIXED&&e.strategy!=x.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!c.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new x.Zlib(t);var r=this;this._hadError=!1,this._binding.onerror=function(a,o){r._binding=null,r._hadError=!0;var s=new Error(a);s.errno=o,s.code=Rt[o],r.emit("error",s)};var i=x.Z_DEFAULT_COMPRESSION;typeof e.level=="number"&&(i=e.level);var n=x.Z_DEFAULT_STRATEGY;typeof e.strategy=="number"&&(n=e.strategy),this._binding.init(e.windowBits||x.Z_DEFAULT_WINDOWBITS,i,e.memLevel||x.Z_DEFAULT_MEMLEVEL,n,e.dictionary),this._buffer=new c(this._chunkSize),this._offset=0,this._closed=!1,this._level=i,this._strategy=n,this.once("end",this.close)}j(D,X),D.prototype.params=function(e,t,r){if(e<x.Z_MIN_LEVEL||e>x.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(t!=x.Z_FILTERED&&t!=x.Z_HUFFMAN_ONLY&&t!=x.Z_RLE&&t!=x.Z_FIXED&&t!=x.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+t);if(this._level!==e||this._strategy!==t){var i=this;this.flush(x.Z_SYNC_FLUSH,function(){i._binding.params(e,t),i._hadError||(i._level=e,i._strategy=t,r&&r())})}else fe.nextTick(r)},D.prototype.reset=function(){return this._binding.reset()},D.prototype._flush=function(e){this._transform(new c(0),"",e)},D.prototype.flush=function(e,t){var r=this._writableState;if((typeof e=="function"||e===void 0&&!t)&&(t=e,e=x.Z_FULL_FLUSH),r.ended)t&&fe.nextTick(t);else if(r.ending)t&&this.once("end",t);else if(r.needDrain){var i=this;this.once("drain",function(){i.flush(t)})}else this._flushFlag=e,this.write(new c(0),"",t)},D.prototype.close=function(e){if(e&&fe.nextTick(e),!this._closed){this._closed=!0,this._binding.close();var t=this;fe.nextTick(function(){t.emit("close")})}},D.prototype._transform=function(e,t,r){var i,n=this._writableState,a=n.ending||n.ended,o=a&&(!e||n.length===e.length);if(!e===null&&!c.isBuffer(e))return r(new Error("invalid input"));o?i=x.Z_FINISH:(i=this._flushFlag,e.length>=n.length&&(this._flushFlag=this._opts.flush||x.Z_NO_FLUSH)),this._processChunk(e,i,r)},D.prototype._processChunk=function(e,t,r){var i=e&&e.length,n=this._chunkSize-this._offset,a=0,o=this,s=typeof r=="function";if(!s){var h=[],f=0,l;this.on("error",function(b){l=b});do var _=this._binding.writeSync(t,e,a,i,this._buffer,this._offset,n);while(!this._hadError&&v(_[0],_[1]));if(this._hadError)throw l;var g=c.concat(h,f);return this.close(),g}var u=this._binding.write(t,e,a,i,this._buffer,this._offset,n);u.buffer=e,u.callback=v;function v(b,y){if(!o._hadError){var E=n-y;if(jl(E>=0,"have should not go down"),E>0){var d=o._buffer.slice(o._offset,o._offset+E);o._offset+=E,s?o.push(d):(h.push(d),f+=d.length)}if((y===0||o._offset>=o._chunkSize)&&(n=o._chunkSize,o._offset=0,o._buffer=new c(o._chunkSize)),y===0){if(a+=i-b,i=b,!s)return!0;var w=o._binding.write(t,e,a,i,o._buffer,o._offset,o._chunkSize);w.callback=v,w.buffer=e;return}if(!s)return!1;r()}}},j(Pe,D),j(Ze,D),j(je,D),j($e,D),j(He,D),j(We,D),j(Ke,D);var Ca={codes:Rt,createDeflate:$l,createInflate:Hl,createDeflateRaw:Wl,createInflateRaw:Kl,createGzip:Yl,createGunzip:ql,createUnzip:Gl,deflate:Vl,deflateSync:Xl,gzip:Jl,gzipSync:Ql,deflateRaw:eh,deflateRawSync:th,unzip:rh,unzipSync:ih,inflate:nh,inflateSync:ah,gunzip:oh,gunzipSync:sh,inflateRaw:fh,inflateRawSync:lh,Deflate:Pe,Inflate:Ze,Gzip:je,Gunzip:$e,DeflateRaw:He,InflateRaw:We,Unzip:Ke,Zlib:D},At=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function uh(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}),r}var La={exports:{}};function ch(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ii={exports:{}},dh={},Ia=Object.freeze({__proto__:null,default:dh}),ph=uh(Ia),Ma;function _h(){return Ma||(Ma=1,function(e,t){(function(r,i){e.exports=i()})(At,function(){var r=r||function(i,n){var a;if(typeof window<"u"&&window.crypto&&(a=window.crypto),typeof self<"u"&&self.crypto&&(a=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(a=globalThis.crypto),!a&&typeof window<"u"&&window.msCrypto&&(a=window.msCrypto),!a&&typeof At<"u"&&At.crypto&&(a=At.crypto),!a&&typeof ch=="function")try{a=ph}catch{}var o=function(){if(a){if(typeof a.getRandomValues=="function")try{return a.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof a.randomBytes=="function")try{return a.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function d(){}return function(w){var p;return d.prototype=w,p=new d,d.prototype=null,p}}(),h={},f=h.lib={},l=f.Base=function(){return{extend:function(d){var w=s(this);return d&&w.mixIn(d),(!w.hasOwnProperty("init")||this.init===w.init)&&(w.init=function(){w.$super.init.apply(this,arguments)}),w.init.prototype=w,w.$super=this,w},create:function(){var d=this.extend();return d.init.apply(d,arguments),d},init:function(){},mixIn:function(d){for(var w in d)d.hasOwnProperty(w)&&(this[w]=d[w]);d.hasOwnProperty("toString")&&(this.toString=d.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),_=f.WordArray=l.extend({init:function(d,w){d=this.words=d||[],w!=n?this.sigBytes=w:this.sigBytes=d.length*4},toString:function(d){return(d||u).stringify(this)},concat:function(d){var w=this.words,p=d.words,S=this.sigBytes,T=d.sigBytes;if(this.clamp(),S%4)for(var m=0;m<T;m++){var A=p[m>>>2]>>>24-m%4*8&255;w[S+m>>>2]|=A<<24-(S+m)%4*8}else for(var R=0;R<T;R+=4)w[S+R>>>2]=p[R>>>2];return this.sigBytes+=T,this},clamp:function(){var d=this.words,w=this.sigBytes;d[w>>>2]&=4294967295<<32-w%4*8,d.length=i.ceil(w/4)},clone:function(){var d=l.clone.call(this);return d.words=this.words.slice(0),d},random:function(d){for(var w=[],p=0;p<d;p+=4)w.push(o());return new _.init(w,d)}}),g=h.enc={},u=g.Hex={stringify:function(d){for(var w=d.words,p=d.sigBytes,S=[],T=0;T<p;T++){var m=w[T>>>2]>>>24-T%4*8&255;S.push((m>>>4).toString(16)),S.push((m&15).toString(16))}return S.join("")},parse:function(d){for(var w=d.length,p=[],S=0;S<w;S+=2)p[S>>>3]|=parseInt(d.substr(S,2),16)<<24-S%8*4;return new _.init(p,w/2)}},v=g.Latin1={stringify:function(d){for(var w=d.words,p=d.sigBytes,S=[],T=0;T<p;T++){var m=w[T>>>2]>>>24-T%4*8&255;S.push(String.fromCharCode(m))}return S.join("")},parse:function(d){for(var w=d.length,p=[],S=0;S<w;S++)p[S>>>2]|=(d.charCodeAt(S)&255)<<24-S%4*8;return new _.init(p,w)}},b=g.Utf8={stringify:function(d){try{return decodeURIComponent(escape(v.stringify(d)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(d){return v.parse(unescape(encodeURIComponent(d)))}},y=f.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new _.init,this._nDataBytes=0},_append:function(d){typeof d=="string"&&(d=b.parse(d)),this._data.concat(d),this._nDataBytes+=d.sigBytes},_process:function(d){var w,p=this._data,S=p.words,T=p.sigBytes,m=this.blockSize,A=m*4,R=T/A;d?R=i.ceil(R):R=i.max((R|0)-this._minBufferSize,0);var k=R*m,O=i.min(k*4,T);if(k){for(var K=0;K<k;K+=m)this._doProcessBlock(S,K);w=S.splice(0,k),p.sigBytes-=O}return new _.init(w,O)},clone:function(){var d=l.clone.call(this);return d._data=this._data.clone(),d},_minBufferSize:0});f.Hasher=y.extend({cfg:l.extend(),init:function(d){this.cfg=this.cfg.extend(d),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(d){return this._append(d),this._process(),this},finalize:function(d){d&&this._append(d);var w=this._doFinalize();return w},blockSize:16,_createHelper:function(d){return function(w,p){return new d.init(p).finalize(w)}},_createHmacHelper:function(d){return function(w,p){return new E.HMAC.init(d,p).finalize(w)}}});var E=h.algo={};return h}(Math);return r})}(ii)),ii.exports}(function(e,t){(function(r,i){e.exports=i(_h())})(At,function(r){return function(i){var n=r,a=n.lib,o=a.WordArray,s=a.Hasher,h=n.algo,f=[],l=[];(function(){function u(E){for(var d=i.sqrt(E),w=2;w<=d;w++)if(!(E%w))return!1;return!0}function v(E){return(E-(E|0))*4294967296|0}for(var b=2,y=0;y<64;)u(b)&&(y<8&&(f[y]=v(i.pow(b,1/2))),l[y]=v(i.pow(b,1/3)),y++),b++})();var _=[],g=h.SHA256=s.extend({_doReset:function(){this._hash=new o.init(f.slice(0))},_doProcessBlock:function(u,v){for(var b=this._hash.words,y=b[0],E=b[1],d=b[2],w=b[3],p=b[4],S=b[5],T=b[6],m=b[7],A=0;A<64;A++){if(A<16)_[A]=u[v+A]|0;else{var R=_[A-15],k=(R<<25|R>>>7)^(R<<14|R>>>18)^R>>>3,O=_[A-2],K=(O<<15|O>>>17)^(O<<13|O>>>19)^O>>>10;_[A]=k+_[A-7]+K+_[A-16]}var Ye=p&S^~p&T,Tt=y&E^y&d^E&d,Ct=(y<<30|y>>>2)^(y<<19|y>>>13)^(y<<10|y>>>22),qe=(p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25),Re=m+qe+Ye+l[A]+_[A],Na=Ct+Tt;m=T,T=S,S=p,p=w+Re|0,w=d,d=E,E=y,y=Re+Na|0}b[0]=b[0]+y|0,b[1]=b[1]+E|0,b[2]=b[2]+d|0,b[3]=b[3]+w|0,b[4]=b[4]+p|0,b[5]=b[5]+S|0,b[6]=b[6]+T|0,b[7]=b[7]+m|0},_doFinalize:function(){var u=this._data,v=u.words,b=this._nDataBytes*8,y=u.sigBytes*8;return v[y>>>5]|=128<<24-y%32,v[(y+64>>>9<<4)+14]=i.floor(b/4294967296),v[(y+64>>>9<<4)+15]=b,u.sigBytes=v.length*4,this._process(),this._hash},clone:function(){var u=s.clone.call(this);return u._hash=this._hash.clone(),u}});n.SHA256=s._createHelper(g),n.HmacSHA256=s._createHmacHelper(g)}(Math),r.SHA256})})(La);var gh=La.exports,wh=hh(gh);const rr={json:"json",avro:"avro"},vh={serialize:e=>JSON.stringify(e),unserialize:e=>JSON.parse(e)},Oa=Ba.Type.forSchema({name:"Cache",type:"record",fields:[{name:"data",type:["string"]}]}),mh={serialize:e=>String(Oa.toBuffer(e)),unserialize:e=>Oa.fromBuffer(Buffer.from(e))};class bh{constructor({s3Client:t,compressData:r=!0,serializer:i=rr.json}){this.s3Client=t,this.serializer=i,this.compressData=r,this.serializers={[rr.json]:vh,[rr.avro]:mh}}getKey({params:t,hashed:r=!0,additionalPrefix:i=""}){let n=Object.keys(t||{}).sort().map(a=>`${a}:${t[a]}`).join("|")||"";return n.length===0&&(n="empty"),r&&(n=wh(n)),i.length>0&&(n=i+n),n=n+"."+this.serializer,this.compressData&&(n+=".gz"),Y.join("cache",n)}async _put({key:t,data:r}){const i=P.isString(r)?r.length:JSON.stringify(r).length;let n=this.serialize({data:r});const a=n.length;this.compressData&&(n=Ca.gzipSync(n));const o={compressor:"zlib","client-id":this.s3Client.id,serializer:String(this.serializer),compressed:String(this.compressData),"length-raw":String(i),"length-serialized":String(a),"length-compressed":String(n.length)};return this.s3Client.putObject({key:t,body:n,metadata:o,contentEncoding:this.compressData?"gzip":null,contentType:this.compressData?"application/gzip":`application/${this.serializer}`})}async _get({key:t}){try{const r=await this.s3Client.getObject(t);if(!r.Body)return"";let i=r.Body;if(r.Metadata){const{serializer:n,compressor:a,compressed:o}=r.Metadata;["true",!0].includes(o)&&a==="zlib"&&(i=Ca.unzipSync(i));const{data:s}=this.serializers[n].unserialize(i);return s}return this.unserialize(i)}catch(r){if(r.name!=="ClientNoSuchKey")return Promise.reject(r)}return null}async _delete({key:t}){try{await this.s3Client.deleteObject(t)}catch(r){if(r.name!=="ClientNoSuchKey")return Promise.reject(r)}return!0}serialize(t){return this.serializers[this.serializer].serialize(t)}unserialize(t){return this.serializers[this.serializer].unserialize(t)}}class yh extends bh{constructor({resource:t,compressData:r=!0,serializer:i=rr.json}){super({s3Client:t.s3Client,compressData:r,serializer:i}),this.resource=t}getKey({action:t="list",params:r}){return super.getKey({params:r,additionalPrefix:`resource=${this.resource.name}/action=${t}|`})}async put({action:t="list",params:r,data:i}){return super._put({data:i,key:this.getKey({action:t,params:r})})}async get({action:t="list",params:r}){return super._get({key:this.getKey({action:t,params:r})})}async delete({action:t="list",params:r}){const i=this.getKey({action:t,params:r});return super._delete({key:i})}async purge(){const t=await this.s3Client.getAllKeys({prefix:`cache/resource=${this.resource.name}`});await this.s3Client.deleteObjects(t)}}class xh extends nr.Writable{constructor({resource:t}){super({objectMode:!0,highWaterMark:t.s3Client.parallelism*2}),this.resource=t,this.contents=[],this.running=null,this.receivedFinalMessage=!1}async _write(t,r,i){return this.running&&await this.running,P.isEmpty(t)?this.receivedFinalMessage=!0:this.contents.push(t),this.running=this.writeOrWait(),i(null)}async _writev(t,r){if(this.running&&await this.running,P.isEmpty(t))this.receivedFinalMessage=!0;else for(const i of t.map(n=>n.chunk))this.contents.push(i);return this.running=this.writeOrWait(),r(null)}async writeOrWait(){if(this.receivedFinalMessage){const r=this.contents.splice(0,this.contents.length-1);await this.resource.insertMany(r),this.emit("end");return}if(this.contents.length<this.resource.s3Client.parallelism)return;const t=this.contents.splice(0,this.resource.s3Client.parallelism);t.forEach(r=>this.emit("id",r.id)),await this.resource.insertMany(t),t.forEach(r=>this.emit("data",r))}async _final(t){this.receivedFinalMessage=!0,await this.writeOrWait(),t(null)}}class Eh extends nr.Readable{constructor({resource:t}){super({objectMode:!0,highWaterMark:t.s3Client.parallelism*3}),this.resource=t,this.pagesCount=0,this.content=[],this.finishedReadingResource=!1,this.loading=this.getItems()}async _read(t){if(this.content.length===0){if(this.loading)await this.loading;else if(this.finishedReadingResource){this.push(null);return}}const r=this.content.shift();this.push(r)}async getItems({continuationToken:t=null}={}){this.emit("page",this.pagesCount++);const r=await this.resource.s3Client.listObjects({prefix:`resource=${this.resource.name}`,continuationToken:t});if(r.Contents){const i=P.chunk(r.Contents,this.resource.s3Client.parallelism);await Ae.PromisePool.for(i).withConcurrency(5).handleError(async(n,a)=>{this.emit("error",n,a)}).process(n=>{const a=n.map(o=>(o.Key||"").replace(Y.join(this.resource.s3Client.keyPrefix,`resource=${this.resource.name}`,"id="),""));this.content.push(a),a.forEach(o=>this.emit("id",o))})}this.finishedReadingResource=!r.IsTruncated,r.NextContinuationToken?this.loading=this.getItems({continuationToken:r.NextContinuationToken}):this.loading=null}}class Sh extends nr.Transform{constructor({resource:t}){super({objectMode:!0,highWaterMark:t.s3Client.parallelism*2}),this.resource=t}async _transform(t,r,i){P.isArray(t)||this.push(null),this.emit("page",t),await Ae.PromisePool.for(t).withConcurrency(this.resource.s3Client.parallelism).handleError(async(n,a)=>{this.emit("error",n,a)}).process(async n=>{this.emit("id",n);const a=await this.resource.get(n);return this.push(a),a}),i(null)}}class Fa extends C{constructor({name:t,client:r,options:i={},attributes:n={},parallelism:a=10,passphrase:o="secret",validatorInstance:s=null,observers:h=[]}){super(),this.name=t,this.client=r,this.options=i,this.observers=h,this.parallelism=a,this.passphrase=o??10,this.schema=P.merge({$$async:!0},ae.flatten(n,{safe:!0})),s||(s=new cr({passphrase:this.passphrase??"secret"})),this.validator=s.compile(this.schema);const{mapObj:f,reversedMapObj:l}=this.getMappersFromSchema(this.schema);this.mapObj=f,this.reversedMapObj=l,this.parseSchema(),this.options.cache===!0&&(this.s3Cache=new yh({resource:this,compressData:!0,serializer:"json"}))}getMappersFromSchema(t){let r=0;const i=P.sortBy(Object.entries(t),["0"]).reduce((a,[o])=>(a[o]=String(r++),a),{}),n=Object.entries(i).reduce((a,[o,s])=>(a[String(s)]=o,a),{});return{mapObj:i,reversedMapObj:n}}export(){const t={name:this.name,schema:{...this.schema},mapper:this.mapObj,options:this.options};for(const[r,i]of Object.entries(this.schema))t.schema[r]=JSON.stringify(i);return t}parseSchema(){this.options.afterUnmap||(this.options.beforeMap={}),this.options.afterUnmap||(this.options.afterUnmap={});const t=ae.flatten(this.schema,{safe:!0}),r=(i,n,a)=>{this.options[i][n]||(this.options[i][n]=[]),this.options[i][n]=[...new Set([...this.options[i][n],a])]};for(const[i,n]of Object.entries(t))n.includes("secret")&&this.options.autoDecrypt===!0&&r("afterUnmap",i,"decrypt"),n.includes("array")&&(r("beforeMap",i,"fromArray"),r("afterUnmap",i,"toArray")),n.includes("number")&&(r("beforeMap",i,"toString"),r("afterUnmap",i,"toNumber")),n.includes("boolean")&&(r("beforeMap",i,"toJson"),r("afterUnmap",i,"fromJson"))}async check(t){const r={original:{...t},isValid:!1,errors:[]},i=await this.validator(t);return i===!0?r.isValid=!0:r.errors=i,{...r,data:t}}validate(t){return this.check(ae.flatten(t,{safe:!0}))}map(t){let r={...t};for(const[i,n]of Object.entries(this.options.beforeMap))for(const a of n)a==="fromArray"?r[i]=(r[i]||[]).join("|"):a==="toString"?r[i]=String(r[i]):a==="toJson"&&(r[i]=JSON.stringify(r[i]));return r=Object.entries(r).reduce((i,[n,a])=>(i[this.mapObj[n]]=P.isArray(a)?a.join("|"):a,i),{}),r}unmap(t){const r=Object.entries(t).reduce((i,[n,a])=>(i[this.reversedMapObj[n]]=a,i),{});for(const[i,n]of Object.entries(this.options.afterUnmap))for(const a of n)if(a==="decrypt"){let o=r[i];o=yi(o,this.passphrase),r[i]=o}else a==="toArray"?r[i]=(r[i]||"").split("|"):a==="toNumber"?r[i]=Number(r[i]||""):a==="fromJson"&&(r[i]=JSON.parse(r[i]));return r}async insert(t){let{id:r,...i}=ae.flatten(t,{safe:!0});const{isValid:n,errors:a,data:o}=await this.check(i);if(!n)return Promise.reject(new lr({bucket:this.client.config.bucket,resourceName:this.name,attributes:t,validation:a}));!r&&r!==0&&(r=ir.nanoid());const s=this.map(o);await this.client.putObject({key:Y.join(`resource=${this.name}`,`id=${r}`),metadata:s});const h={id:r,...ae.unflatten(this.unmap(s))};return this.s3Cache&&await this.s3Cache.purge(),this.emit("insert",h),h}async get(t){const r=await this.client.headObject(Y.join(`resource=${this.name}`,`id=${t}`));let i=this.unmap(r.Metadata);return i=ae.unflatten(i),i.id=t,i._length=r.ContentLength,i._createdAt=r.LastModified,r.Expiration&&(i._expiresAt=r.Expiration),this.emit("get",i),i}async update(t,r){const i=await this.get(t),n=ae.flatten(r,{safe:!0}),a=ae.flatten(i,{safe:!0}),o=P.merge(a,n);delete o.id;const{isValid:s,errors:h,data:f}=await this.check(o);if(!s)return Promise.reject(new S3dbInvalidResource({bucket:this.client.bucket,resourceName:this.name,attributes:r,validation:h}));!t&&t!==0&&(t=ir.nanoid()),await this.client.putObject({key:Y.join(`resource=${this.name}`,`id=${t}`),body:"",metadata:this.map(f)});const l={id:t,...ae.unflatten(f)};return this.s3Cache&&await this.s3Cache.purge(),this.emit("update",r,l),l}async delete(t){const r=Y.join(`resource=${this.name}`,`id=${t}`),i=await this.client.deleteObject(r);return this.s3Cache&&await this.s3Cache.purge(),this.emit("delete",t),i}async count(){if(this.s3Cache){const r=await this.s3Cache.get({action:"count"});if(r)return r}const t=await this.client.count({prefix:`resource=${this.name}`});return this.s3Cache&&await this.s3Cache.put({action:"count",data:t}),this.emit("count",t),t}async insertMany(t){const{results:r}=await Ae.PromisePool.for(t).withConcurrency(this.parallelism).handleError(async(i,n)=>{this.emit("error",i,n),this.observers.map(a=>a.emit("error",this.name,i,n))}).process(async i=>await this.insert(i));return this.emit("insertMany",t.length),r}async deleteMany(t){const r=P.chunk(t.map(n=>Y.join(`resource=${this.name}`,`id=${n}`)),1e3),{results:i}=await Ae.PromisePool.for(r).withConcurrency(this.parallelism).handleError(async(n,a)=>{this.emit("error",n,a),this.observers.map(o=>o.emit("error",this.name,n,a))}).process(async n=>{const a=await this.client.deleteObjects(n);return n.forEach(o=>{const s=o.split("=").pop();this.emit("deleted",s),this.observers.map(h=>h.emit("deleted",this.name,s))}),a});return this.s3Cache&&await this.s3Cache.purge(),this.emit("deleteMany",t.length),i}async deleteAll(){const t=await this.listIds();this.emit("deleteAll",t.length),await this.deleteMany(t)}async listIds(){if(this.s3Cache){const i=await this.s3Cache.get({action:"listIds"});if(i)return i}const r=(await this.client.getAllKeys({prefix:`resource=${this.name}`})).map(i=>i.replace(`resource=${this.name}/id=`,""));return this.s3Cache&&await this.s3Cache.put({action:"listIds",data:r}),this.emit("listIds",r.length),r}async getMany(t){if(this.s3Cache){const i=await this.s3Cache.get({action:"getMany",params:{ids:t.sort()}});if(i)return i}const{results:r}=await Ae.PromisePool.for(t).withConcurrency(this.client.parallelism).process(async i=>{this.emit("id",i);const n=await this.get(i);return this.emit("data",n),n});return this.s3Cache&&await this.s3Cache.put({action:"getMany",params:{ids:t.sort()},data:r}),this.emit("getMany",t.length),r}async getAll(){if(this.s3Cache){const n=await this.s3Cache.get({action:"getAll"});if(n)return n}let t=[],r=!1;if(this.s3Cache){const n=await this.s3Cache.get({action:"listIds"});n&&(t=n,r=!0)}if(r||(t=await this.listIds()),t.length===0)return[];const{results:i}=await Ae.PromisePool.for(t).withConcurrency(this.client.parallelism).process(async n=>await this.get(n));return this.s3Cache&&i.length>0&&await this.s3Cache.put({action:"getAll",data:i}),this.emit("getAll",i.length),i}async page({offset:t=0,size:r=100}){if(this.s3Cache){const o=await this.s3Cache.get({action:"page",params:{offset:t,size:r}});if(o)return o}const n=(await this.client.getKeysPage({amount:r,offset:t,prefix:`resource=${this.name}`})).map(o=>o.replace(`resource=${this.name}/id=`,"")),a=await this.getMany(n);return this.s3Cache&&await this.s3Cache.put({action:"page",params:{offset:t,size:r},data:a}),a}readable(){const t=new Eh({resource:this}),r=new Sh({resource:this});return t.pipe(r)}writable(){return new xh({resource:this})}}function kh(e){return new Promise((t,r)=>{const i=[];e.on("data",n=>i.push(n)),e.on("error",r),e.on("end",()=>t(Buffer.concat(i).toString("utf-8")))})}class Da extends C{constructor(t){super(),this.version="1",this.resources={},this.options=t,this.verbose=t.verbose||!1,this.parallelism=parseInt(t.parallelism+"")||10,this.plugins=t.plugins||[],this.cache=t.cache,this.passphrase=t.passphrase||"secret",this.validatorInstance=new cr({passphrase:this.passphrase}),this.client=t.client||new mi({verbose:this.verbose,parallelism:this.parallelism,connectionString:t.connectionString}),this.bucket=this.client.bucket,this.keyPrefix=this.client.keyPrefix,this.startPlugins()}async connect(){let t=null;if(await this.client.exists("s3db.json")){const r=await this.client.getObject("s3db.json");t=JSON.parse(await kh(r?.Body)),t=this.unserializeMetadata(t)}else t=this.blankMetadataStructure(),await this.uploadMetadataFile();for(const r of Object.entries(t.resources)){const[i,n]=r;this.resources[i]=new Fa({name:i,s3db:this,s3Client:this.client,schema:n.schema,options:n.options,validatorInstance:this.validatorInstance})}this.emit("connected",new Date)}async startPlugins(){if(this.plugins&&!P.isEmpty(this.plugins)){const t=this.plugins.map(async i=>{i.beforeSetup&&await i.beforeSetup(),await i.setup(this),i.afterSetup&&await i.afterSetup()});await Promise.all(t);const r=this.plugins.map(async i=>{i.beforeStart&&await i.beforeStart(),await i.start(),i.afterStart&&await i.afterStart()});await Promise.all(r)}}unserializeMetadata(t){const r={...t};if(P.isEmpty(r.resources))return r;for(const[i,n]of Object.entries(r.resources))for(const[a,o]of Object.entries(n.schema))r.resources[i].schema[a]=JSON.parse(o);return r}async uploadMetadataFile(){const t={version:this.version,resources:Object.entries(this.resources).reduce((r,i)=>{const[n,a]=i;return r[n]=a.export(),r},{})};await this.client.putObject({key:"s3db.json",contentType:"application/json",body:JSON.stringify(t,null,2)})}blankMetadataStructure(){return{version:"1",resources:{}}}async createResource({name:t,attributes:r,options:i={}}){const n=new Fa({name:t,attributes:r,observers:[this],client:this.client,validatorInstance:this.validatorInstance,options:{autoDecrypt:!0,cache:this.cache,...i}});return this.resources[t]=n,await this.uploadMetadataFile(),this.emit("s3db.resourceCreated",t),n}resource(t){return this.resources[t]?this.resources[t]:Promise.reject(`resource ${t} does not exist`)}}class Rh extends Da{}class Ah extends C{async setup(t){}async start(){}async stop(){}beforeSetup(){this.emit("plugin.beforeSetup",new Date)}afterSetup(){this.emit("plugin.afterSetup",new Date)}beforeStart(){this.emit("plugin.beforeStart",new Date)}afterStart(){this.emit("plugin.afterStart",new Date)}beforeStop(){this.emit("plugin.beforeStop",new Date)}afterStop(){this.emit("plugin.afterStop",new Date)}}const Th={setup(e){},start(){},stop(){}};exports.BaseError=Ge,exports.Client=mi,exports.ConnectionString=vi,exports.Database=Da,exports.ErrorMap=_i,exports.InvalidResourceItem=lr,exports.MissingMetadata=di,exports.NoSuchBucket=ui,exports.NoSuchKey=fr,exports.NotFound=ci,exports.Plugin=Ah,exports.PluginObject=Th,exports.S3_DEFAULT_ENDPOINT=wi,exports.S3_DEFAULT_REGION=gi,exports.S3db=Rh,exports.UnknownError=pi,exports.Validator=cr,exports.decrypt=yi,exports.encrypt=bi;
